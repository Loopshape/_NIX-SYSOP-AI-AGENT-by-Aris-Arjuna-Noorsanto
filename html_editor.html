<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Quantum Fractal AI Cockpit</title>
<style>
  body { margin:0; background:#0f0f2a; overflow:hidden; }
  #editor { position:absolute; top:0; left:0; width:50%; height:100%; }
  canvas { display:block; width:50%; height:100%; position:absolute; right:0; top:0; }
</style>
</head>
<body>

<div id="editor"></div>
<canvas id="three-canvas"></canvas>

<!-- ACE Editor -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.14.0/ace.js"></script>
<script type="module">
import * as THREE from 'https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.module.js';

const canvas = document.getElementById('three-canvas');
const scene = new THREE.Scene();
const camera = new THREE.PerspectiveCamera(70, canvas.clientWidth / canvas.clientHeight, 0.1, 1000);
camera.position.z = 5;

const renderer = new THREE.WebGLRenderer({canvas, antialias:true});
renderer.setSize(canvas.clientWidth, canvas.clientHeight);

const cube = new THREE.Mesh(new THREE.BoxGeometry(1,1,1), new THREE.MeshStandardMaterial({color:0xff00ff}));
scene.add(cube);

// Lights
const light = new THREE.PointLight(0xffffff,1);
light.position.set(5,5,5);
scene.add(light);

// Particles representing models
const models = ['cube','core','loop','wave','coin','code'];
const particles = {};
models.forEach(m=>{
  const mesh = new THREE.Mesh(new THREE.SphereGeometry(0.1,16,16), new THREE.MeshStandardMaterial({color:Math.random()*0xffffff}));
  mesh.position.set(Math.random()*4-2, Math.random()*4-2, Math.random()*4-2);
  scene.add(mesh);
  particles[m]=mesh;
});

// Animate
function animate(){
  requestAnimationFrame(animate);
  // Simple rotation for cube
  cube.rotation.x += 0.003;
  cube.rotation.y += 0.004;
  
  // Move particles toward cube
  for(const m of models){
    const p = particles[m];
    p.position.lerp(cube.position, p.progress || 0.02);
  }

  renderer.render(scene,camera);
}
animate();

// ----------------- WebSocket -----------------
const ws = new WebSocket('ws://localhost:3000');
ws.onopen = ()=>console.log('[WS] connected');
ws.onmessage = e=>{
  const msg = JSON.parse(e.data);
  if(msg.type==='modelProgress'){
    if(particles[msg.model]) particles[msg.model].progress = (msg.progress||0)/100;
  }
  if(msg.type==='modelDone'){
    if(particles[msg.model]) particles[msg.model].progress = 1;
  }
  if(msg.type==='final'){
    console.log('[FINAL RESULT]', msg.result);
  }
};

// ----------------- ACE Editor -----------------
const editor = ace.edit('editor');
editor.setTheme('ace/theme/monokai');
editor.session.setMode('ace/mode/javascript');

// Send editor content on Shift+Win+R
window.addEventListener('keydown',e=>{
  if(e.shiftKey && e.metaKey && e.code==='KeyR'){
    ws.send(JSON.stringify({type:'prompt',prompt:editor.getValue()}));
  }
});
</script>
</body>
</html>

