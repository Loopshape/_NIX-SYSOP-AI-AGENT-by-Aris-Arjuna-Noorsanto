(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))o(s);new MutationObserver(s=>{for(const l of s)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const l={};return s.integrity&&(l.integrity=s.integrity),s.referrerPolicy&&(l.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?l.credentials="include":s.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function o(s){if(s.ep)return;s.ep=!0;const l=t(s);fetch(s.href,l)}})();let bt,Wt;function Kt(){return{geminiUrl:bt,vertexUrl:Wt}}function zt(n,e,t,o){var s,l;if(!n?.baseUrl){const a=Kt();return e?(s=a.vertexUrl)!==null&&s!==void 0?s:t:(l=a.geminiUrl)!==null&&l!==void 0?l:o}return n.baseUrl}class K{}function T(n,e){const t=/\{([^}]+)\}/g;return n.replace(t,(o,s)=>{if(Object.prototype.hasOwnProperty.call(e,s)){const l=e[s];return l!=null?String(l):""}else throw new Error(`Key '${s}' not found in valueMap.`)})}function r(n,e,t){for(let l=0;l<e.length-1;l++){const a=e[l];if(a.endsWith("[]")){const u=a.slice(0,-2);if(!(u in n))if(Array.isArray(t))n[u]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${a}`);if(Array.isArray(n[u])){const f=n[u];if(Array.isArray(t))for(let d=0;d<f.length;d++){const c=f[d];r(c,e.slice(l+1),t[d])}else for(const d of f)r(d,e.slice(l+1),t)}return}else if(a.endsWith("[0]")){const u=a.slice(0,-3);u in n||(n[u]=[{}]);const f=n[u];r(f[0],e.slice(l+1),t);return}(!n[a]||typeof n[a]!="object")&&(n[a]={}),n=n[a]}const o=e[e.length-1],s=n[o];if(s!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===s)return;if(typeof s=="object"&&typeof t=="object"&&s!==null&&t!==null)Object.assign(s,t);else throw new Error(`Cannot set value for an existing key. Key: ${o}`)}else o==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(n,t):n[o]=t}function i(n,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return n;for(let o=0;o<e.length;o++){if(typeof n!="object"||n===null)return t;const s=e[o];if(s.endsWith("[]")){const l=s.slice(0,-2);if(l in n){const a=n[l];return Array.isArray(a)?a.map(u=>i(u,e.slice(o+1),t)):t}else return t}else n=n[s]}return n}catch(o){if(o instanceof TypeError)return t;throw o}}function Xt(n,e){for(const[t,o]of Object.entries(e)){const s=t.split("."),l=o.split("."),a=new Set;let u=-1;for(let f=0;f<s.length;f++)if(s[f]==="*"){u=f;break}if(u!==-1&&l.length>u)for(let f=u;f<l.length;f++){const d=l[f];d!=="*"&&!d.endsWith("[]")&&!d.endsWith("[0]")&&a.add(d)}Ee(n,s,l,0,a)}}function Ee(n,e,t,o,s){if(o>=e.length||typeof n!="object"||n===null)return;const l=e[o];if(l.endsWith("[]")){const a=l.slice(0,-2),u=n;if(a in u&&Array.isArray(u[a]))for(const f of u[a])Ee(f,e,t,o+1,s)}else if(l==="*"){if(typeof n=="object"&&n!==null&&!Array.isArray(n)){const a=n,u=Object.keys(a).filter(d=>!d.startsWith("_")&&!s.has(d)),f={};for(const d of u)f[d]=a[d];for(const[d,c]of Object.entries(f)){const p=[];for(const m of t.slice(o))m==="*"?p.push(d):p.push(m);r(a,p,c)}for(const d of u)delete a[d]}}else{const a=n;l in a&&Ee(a[l],e,t,o+1,s)}}function we(n){if(typeof n!="string")throw new Error("fromImageBytes must be a string");return n}function Ot(n){const e={},t=i(n,["operationName"]);t!=null&&r(e,["operationName"],t);const o=i(n,["resourceName"]);return o!=null&&r(e,["_url","resourceName"],o),e}function Qt(n){const e={},t=i(n,["name"]);t!=null&&r(e,["name"],t);const o=i(n,["metadata"]);o!=null&&r(e,["metadata"],o);const s=i(n,["done"]);s!=null&&r(e,["done"],s);const l=i(n,["error"]);l!=null&&r(e,["error"],l);const a=i(n,["response","generateVideoResponse"]);return a!=null&&r(e,["response"],jt(a)),e}function Zt(n){const e={},t=i(n,["name"]);t!=null&&r(e,["name"],t);const o=i(n,["metadata"]);o!=null&&r(e,["metadata"],o);const s=i(n,["done"]);s!=null&&r(e,["done"],s);const l=i(n,["error"]);l!=null&&r(e,["error"],l);const a=i(n,["response"]);return a!=null&&r(e,["response"],eo(a)),e}function jt(n){const e={},t=i(n,["generatedSamples"]);if(t!=null){let l=t;Array.isArray(l)&&(l=l.map(a=>no(a))),r(e,["generatedVideos"],l)}const o=i(n,["raiMediaFilteredCount"]);o!=null&&r(e,["raiMediaFilteredCount"],o);const s=i(n,["raiMediaFilteredReasons"]);return s!=null&&r(e,["raiMediaFilteredReasons"],s),e}function eo(n){const e={},t=i(n,["videos"]);if(t!=null){let l=t;Array.isArray(l)&&(l=l.map(a=>to(a))),r(e,["generatedVideos"],l)}const o=i(n,["raiMediaFilteredCount"]);o!=null&&r(e,["raiMediaFilteredCount"],o);const s=i(n,["raiMediaFilteredReasons"]);return s!=null&&r(e,["raiMediaFilteredReasons"],s),e}function no(n){const e={},t=i(n,["video"]);return t!=null&&r(e,["video"],ao(t)),e}function to(n){const e={},t=i(n,["_self"]);return t!=null&&r(e,["video"],uo(t)),e}function oo(n){const e={},t=i(n,["operationName"]);return t!=null&&r(e,["_url","operationName"],t),e}function io(n){const e={},t=i(n,["operationName"]);return t!=null&&r(e,["_url","operationName"],t),e}function so(n){const e={},t=i(n,["name"]);t!=null&&r(e,["name"],t);const o=i(n,["metadata"]);o!=null&&r(e,["metadata"],o);const s=i(n,["done"]);s!=null&&r(e,["done"],s);const l=i(n,["error"]);l!=null&&r(e,["error"],l);const a=i(n,["response"]);return a!=null&&r(e,["response"],ro(a)),e}function ro(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["parent"]);o!=null&&r(e,["parent"],o);const s=i(n,["documentName"]);return s!=null&&r(e,["documentName"],s),e}function pt(n){const e={},t=i(n,["name"]);t!=null&&r(e,["name"],t);const o=i(n,["metadata"]);o!=null&&r(e,["metadata"],o);const s=i(n,["done"]);s!=null&&r(e,["done"],s);const l=i(n,["error"]);l!=null&&r(e,["error"],l);const a=i(n,["response"]);return a!=null&&r(e,["response"],lo(a)),e}function lo(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["parent"]);o!=null&&r(e,["parent"],o);const s=i(n,["documentName"]);return s!=null&&r(e,["documentName"],s),e}function ao(n){const e={},t=i(n,["uri"]);t!=null&&r(e,["uri"],t);const o=i(n,["encodedVideo"]);o!=null&&r(e,["videoBytes"],we(o));const s=i(n,["encoding"]);return s!=null&&r(e,["mimeType"],s),e}function uo(n){const e={},t=i(n,["gcsUri"]);t!=null&&r(e,["uri"],t);const o=i(n,["bytesBase64Encoded"]);o!=null&&r(e,["videoBytes"],we(o));const s=i(n,["mimeType"]);return s!=null&&r(e,["mimeType"],s),e}var $e;(function(n){n.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",n.OUTCOME_OK="OUTCOME_OK",n.OUTCOME_FAILED="OUTCOME_FAILED",n.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})($e||($e={}));var Ye;(function(n){n.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",n.PYTHON="PYTHON"})(Ye||(Ye={}));var be;(function(n){n.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",n.SILENT="SILENT",n.WHEN_IDLE="WHEN_IDLE",n.INTERRUPT="INTERRUPT"})(be||(be={}));var U;(function(n){n.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",n.STRING="STRING",n.NUMBER="NUMBER",n.INTEGER="INTEGER",n.BOOLEAN="BOOLEAN",n.ARRAY="ARRAY",n.OBJECT="OBJECT",n.NULL="NULL"})(U||(U={}));var We;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(We||(We={}));var Ke;(function(n){n.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",n.SIMPLE_SEARCH="SIMPLE_SEARCH",n.ELASTIC_SEARCH="ELASTIC_SEARCH"})(Ke||(Ke={}));var ze;(function(n){n.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",n.NO_AUTH="NO_AUTH",n.API_KEY_AUTH="API_KEY_AUTH",n.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",n.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",n.OAUTH="OAUTH",n.OIDC_AUTH="OIDC_AUTH"})(ze||(ze={}));var Xe;(function(n){n.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",n.HTTP_IN_QUERY="HTTP_IN_QUERY",n.HTTP_IN_HEADER="HTTP_IN_HEADER",n.HTTP_IN_PATH="HTTP_IN_PATH",n.HTTP_IN_BODY="HTTP_IN_BODY",n.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(Xe||(Xe={}));var Oe;(function(n){n.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",n.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",n.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",n.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(Oe||(Oe={}));var Qe;(function(n){n.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",n.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",n.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",n.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",n.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",n.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",n.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",n.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",n.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",n.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(Qe||(Qe={}));var Ze;(function(n){n.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",n.SEVERITY="SEVERITY",n.PROBABILITY="PROBABILITY"})(Ze||(Ze={}));var je;(function(n){n.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE",n.OFF="OFF"})(je||(je={}));var en;(function(n){n.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",n.STOP="STOP",n.MAX_TOKENS="MAX_TOKENS",n.SAFETY="SAFETY",n.RECITATION="RECITATION",n.LANGUAGE="LANGUAGE",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.SPII="SPII",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.IMAGE_SAFETY="IMAGE_SAFETY",n.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",n.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",n.NO_IMAGE="NO_IMAGE"})(en||(en={}));var nn;(function(n){n.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",n.NEGLIGIBLE="NEGLIGIBLE",n.LOW="LOW",n.MEDIUM="MEDIUM",n.HIGH="HIGH"})(nn||(nn={}));var tn;(function(n){n.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",n.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",n.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",n.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",n.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(tn||(tn={}));var on;(function(n){n.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",n.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",n.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",n.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",n.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(on||(on={}));var sn;(function(n){n.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",n.SAFETY="SAFETY",n.OTHER="OTHER",n.BLOCKLIST="BLOCKLIST",n.PROHIBITED_CONTENT="PROHIBITED_CONTENT",n.IMAGE_SAFETY="IMAGE_SAFETY",n.MODEL_ARMOR="MODEL_ARMOR",n.JAILBREAK="JAILBREAK"})(sn||(sn={}));var rn;(function(n){n.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",n.ON_DEMAND="ON_DEMAND",n.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(rn||(rn={}));var ue;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.AUDIO="AUDIO"})(ue||(ue={}));var ln;(function(n){n.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",n.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",n.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",n.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(ln||(ln={}));var an;(function(n){n.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",n.TUNING_MODE_FULL="TUNING_MODE_FULL",n.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(an||(an={}));var un;(function(n){n.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",n.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",n.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",n.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",n.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",n.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",n.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(un||(un={}));var _e;(function(n){n.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",n.JOB_STATE_QUEUED="JOB_STATE_QUEUED",n.JOB_STATE_PENDING="JOB_STATE_PENDING",n.JOB_STATE_RUNNING="JOB_STATE_RUNNING",n.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",n.JOB_STATE_FAILED="JOB_STATE_FAILED",n.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",n.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",n.JOB_STATE_PAUSED="JOB_STATE_PAUSED",n.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",n.JOB_STATE_UPDATING="JOB_STATE_UPDATING",n.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(_e||(_e={}));var dn;(function(n){n.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",n.TUNING_TASK_I2V="TUNING_TASK_I2V",n.TUNING_TASK_T2V="TUNING_TASK_T2V",n.TUNING_TASK_R2V="TUNING_TASK_R2V"})(dn||(dn={}));var fn;(function(n){n.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",n.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",n.BALANCED="BALANCED",n.PRIORITIZE_COST="PRIORITIZE_COST"})(fn||(fn={}));var cn;(function(n){n.UNSPECIFIED="UNSPECIFIED",n.BLOCKING="BLOCKING",n.NON_BLOCKING="NON_BLOCKING"})(cn||(cn={}));var pn;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.MODE_DYNAMIC="MODE_DYNAMIC"})(pn||(pn={}));var mn;(function(n){n.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",n.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(mn||(mn={}));var hn;(function(n){n.MODE_UNSPECIFIED="MODE_UNSPECIFIED",n.AUTO="AUTO",n.ANY="ANY",n.NONE="NONE",n.VALIDATED="VALIDATED"})(hn||(hn={}));var gn;(function(n){n.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",n.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",n.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",n.BLOCK_NONE="BLOCK_NONE"})(gn||(gn={}));var yn;(function(n){n.DONT_ALLOW="DONT_ALLOW",n.ALLOW_ADULT="ALLOW_ADULT",n.ALLOW_ALL="ALLOW_ALL"})(yn||(yn={}));var Tn;(function(n){n.auto="auto",n.en="en",n.ja="ja",n.ko="ko",n.hi="hi",n.zh="zh",n.pt="pt",n.es="es"})(Tn||(Tn={}));var En;(function(n){n.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",n.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",n.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",n.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",n.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(En||(En={}));var _n;(function(n){n.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",n.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",n.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",n.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(_n||(_n={}));var Cn;(function(n){n.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",n.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",n.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",n.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(Cn||(Cn={}));var vn;(function(n){n.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",n.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",n.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",n.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",n.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",n.EDIT_MODE_STYLE="EDIT_MODE_STYLE",n.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",n.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(vn||(vn={}));var Sn;(function(n){n.FOREGROUND="FOREGROUND",n.BACKGROUND="BACKGROUND",n.PROMPT="PROMPT",n.SEMANTIC="SEMANTIC",n.INTERACTIVE="INTERACTIVE"})(Sn||(Sn={}));var In;(function(n){n.ASSET="ASSET",n.STYLE="STYLE"})(In||(In={}));var An;(function(n){n.INSERT="INSERT",n.REMOVE="REMOVE",n.REMOVE_STATIC="REMOVE_STATIC",n.OUTPAINT="OUTPAINT"})(An||(An={}));var Rn;(function(n){n.OPTIMIZED="OPTIMIZED",n.LOSSLESS="LOSSLESS"})(Rn||(Rn={}));var Pn;(function(n){n.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",n.PREFERENCE_TUNING="PREFERENCE_TUNING"})(Pn||(Pn={}));var Mn;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.STATE_PENDING="STATE_PENDING",n.STATE_ACTIVE="STATE_ACTIVE",n.STATE_FAILED="STATE_FAILED"})(Mn||(Mn={}));var Nn;(function(n){n.STATE_UNSPECIFIED="STATE_UNSPECIFIED",n.PROCESSING="PROCESSING",n.ACTIVE="ACTIVE",n.FAILED="FAILED"})(Nn||(Nn={}));var wn;(function(n){n.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",n.UPLOADED="UPLOADED",n.GENERATED="GENERATED"})(wn||(wn={}));var Dn;(function(n){n.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",n.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",n.RESPONSE_REJECTED="RESPONSE_REJECTED",n.NEED_MORE_INPUT="NEED_MORE_INPUT"})(Dn||(Dn={}));var xn;(function(n){n.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",n.TEXT="TEXT",n.IMAGE="IMAGE",n.VIDEO="VIDEO",n.AUDIO="AUDIO",n.DOCUMENT="DOCUMENT"})(xn||(xn={}));var Un;(function(n){n.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",n.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",n.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(Un||(Un={}));var Ln;(function(n){n.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",n.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",n.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(Ln||(Ln={}));var kn;(function(n){n.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",n.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",n.NO_INTERRUPTION="NO_INTERRUPTION"})(kn||(kn={}));var Fn;(function(n){n.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",n.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",n.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(Fn||(Fn={}));var Vn;(function(n){n.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",n.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",n.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",n.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",n.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",n.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",n.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",n.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",n.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",n.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",n.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",n.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",n.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(Vn||(Vn={}));var Gn;(function(n){n.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",n.QUALITY="QUALITY",n.DIVERSITY="DIVERSITY",n.VOCALIZATION="VOCALIZATION"})(Gn||(Gn={}));var Q;(function(n){n.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",n.PLAY="PLAY",n.PAUSE="PAUSE",n.STOP="STOP",n.RESET_CONTEXT="RESET_CONTEXT"})(Q||(Q={}));class Ce{constructor(e){const t={};for(const o of e.headers.entries())t[o[0]]=o[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class ie{get text(){var e,t,o,s,l,a,u,f;if(((s=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let d="",c=!1;const p=[];for(const m of(f=(u=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)!==null&&f!==void 0?f:[]){for(const[h,g]of Object.entries(m))h!=="text"&&h!=="thought"&&(g!==null||g!==void 0)&&p.push(h);if(typeof m.text=="string"){if(typeof m.thought=="boolean"&&m.thought)continue;c=!0,d+=m.text}}return p.length>0&&console.warn(`there are non-text parts ${p} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),c?d:void 0}get data(){var e,t,o,s,l,a,u,f;if(((s=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let d="";const c=[];for(const p of(f=(u=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)!==null&&f!==void 0?f:[]){for(const[m,h]of Object.entries(p))m!=="inlineData"&&(h!==null||h!==void 0)&&c.push(m);p.inlineData&&typeof p.inlineData.data=="string"&&(d+=atob(p.inlineData.data))}return c.length>0&&console.warn(`there are non-data parts ${c} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),d.length>0?btoa(d):void 0}get functionCalls(){var e,t,o,s,l,a,u,f;if(((s=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const d=(f=(u=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(c=>c.functionCall).map(c=>c.functionCall).filter(c=>c!==void 0);if(d?.length!==0)return d}get executableCode(){var e,t,o,s,l,a,u,f,d;if(((s=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const c=(f=(u=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(p=>p.executableCode).map(p=>p.executableCode).filter(p=>p!==void 0);if(c?.length!==0)return(d=c?.[0])===null||d===void 0?void 0:d.code}get codeExecutionResult(){var e,t,o,s,l,a,u,f,d;if(((s=(o=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||o===void 0?void 0:o.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const c=(f=(u=(a=(l=this.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content)===null||u===void 0?void 0:u.parts)===null||f===void 0?void 0:f.filter(p=>p.codeExecutionResult).map(p=>p.codeExecutionResult).filter(p=>p!==void 0);if(c?.length!==0)return(d=c?.[0])===null||d===void 0?void 0:d.output}}class qn{}class Hn{}class fo{}class co{}class po{}class mo{}class Bn{}class Jn{}class $n{}class ho{}class de{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const o=new de;let s;const l=e;return t?s=Zt(l):s=Qt(l),Object.assign(o,s),o}}class Yn{}class bn{}class Wn{}class go{}class yo{}class To{}class De{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const o=new De,l=so(e);return Object.assign(o,l),o}}class Eo{}class _o{}class Co{}class Kn{}class vo{get text(){var e,t,o;let s="",l=!1;const a=[];for(const u of(o=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&o!==void 0?o:[]){for(const[f,d]of Object.entries(u))f!=="text"&&f!=="thought"&&d!==null&&a.push(f);if(typeof u.text=="string"){if(typeof u.thought=="boolean"&&u.thought)continue;l=!0,s+=u.text}}return a.length>0&&console.warn(`there are non-text parts ${a} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),l?s:void 0}get data(){var e,t,o;let s="";const l=[];for(const a of(o=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&o!==void 0?o:[]){for(const[u,f]of Object.entries(a))u!=="inlineData"&&f!==null&&l.push(u);a.inlineData&&typeof a.inlineData.data=="string"&&(s+=atob(a.inlineData.data))}return l.length>0&&console.warn(`there are non-data parts ${l} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}}class So{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class xe{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const o=new xe,l=pt(e);return Object.assign(o,l),o}}function M(n,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(n.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function mt(n,e){const t=M(n,e);return t?t.startsWith("publishers/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}`:t.startsWith("models/")&&n.isVertexAI()?`projects/${n.getProject()}/locations/${n.getLocation()}/publishers/google/${t}`:t:""}function ht(n){return Array.isArray(n)?n.map(e=>fe(e)):[fe(n)]}function fe(n){if(typeof n=="object"&&n!==null)return n;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof n}`)}function gt(n){const e=fe(n);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function yt(n){const e=fe(n);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function zn(n){if(n==null)throw new Error("PartUnion is required");if(typeof n=="object")return n;if(typeof n=="string")return{text:n};throw new Error(`Unsupported part type: ${typeof n}`)}function Tt(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("PartListUnion is required");return Array.isArray(n)?n.map(e=>zn(e)):[zn(n)]}function ve(n){return n!=null&&typeof n=="object"&&"parts"in n&&Array.isArray(n.parts)}function Xn(n){return n!=null&&typeof n=="object"&&"functionCall"in n}function On(n){return n!=null&&typeof n=="object"&&"functionResponse"in n}function V(n){if(n==null)throw new Error("ContentUnion is required");return ve(n)?n:{role:"user",parts:Tt(n)}}function Ue(n,e){if(!e)return[];if(n.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const o=V(t);return o.parts&&o.parts.length>0&&o.parts[0].text!==void 0?[o.parts[0].text]:[]});if(n.isVertexAI()){const t=V(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>V(t)):[V(e)]}function B(n){if(n==null||Array.isArray(n)&&n.length===0)throw new Error("contents are required");if(!Array.isArray(n)){if(Xn(n)||On(n))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[V(n)]}const e=[],t=[],o=ve(n[0]);for(const s of n){const l=ve(s);if(l!=o)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(l)e.push(s);else{if(Xn(s)||On(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(s)}}return o||e.push({role:"user",parts:Tt(t)}),e}function Io(n,e){n.includes("null")&&(e.nullable=!0);const t=n.filter(o=>o!=="null");if(t.length===1)e.type=Object.values(U).includes(t[0].toUpperCase())?t[0].toUpperCase():U.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const o of t)e.anyOf.push({type:Object.values(U).includes(o.toUpperCase())?o.toUpperCase():U.TYPE_UNSPECIFIED})}}function Z(n){const e={},t=["items"],o=["anyOf"],s=["properties"];if(n.type&&n.anyOf)throw new Error("type and anyOf cannot be both populated.");const l=n.anyOf;l!=null&&l.length==2&&(l[0].type==="null"?(e.nullable=!0,n=l[1]):l[1].type==="null"&&(e.nullable=!0,n=l[0])),n.type instanceof Array&&Io(n.type,e);for(const[a,u]of Object.entries(n))if(u!=null)if(a=="type"){if(u==="null")throw new Error("type: null can not be the only possible type for the field.");if(u instanceof Array)continue;e.type=Object.values(U).includes(u.toUpperCase())?u.toUpperCase():U.TYPE_UNSPECIFIED}else if(t.includes(a))e[a]=Z(u);else if(o.includes(a)){const f=[];for(const d of u){if(d.type=="null"){e.nullable=!0;continue}f.push(Z(d))}e[a]=f}else if(s.includes(a)){const f={};for(const[d,c]of Object.entries(u))f[d]=Z(c);e[a]=f}else{if(a==="additionalProperties")continue;e[a]=u}return e}function Le(n){return Z(n)}function ke(n){if(typeof n=="object")return n;if(typeof n=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:n}}};throw new Error(`Unsupported speechConfig type: ${typeof n}`)}function Fe(n){if("multiSpeakerVoiceConfig"in n)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return n}function ne(n){if(n.functionDeclarations)for(const e of n.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=Z(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=Z(e.response));return n}function te(n){if(n==null)throw new Error("tools is required");if(!Array.isArray(n))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of n)e.push(t);return e}function Ao(n,e,t,o=1){const s=!e.startsWith(`${t}/`)&&e.split("/").length===o;return n.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${n.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${n.getProject()}/locations/${n.getLocation()}/${e}`:s?`projects/${n.getProject()}/locations/${n.getLocation()}/${t}/${e}`:e:s?`${t}/${e}`:e}function z(n,e){if(typeof e!="string")throw new Error("name must be a string");return Ao(n,e,"cachedContents")}function Et(n){switch(n){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return n}}function X(n){return we(n)}function Ro(n){return n!=null&&typeof n=="object"&&"name"in n}function Po(n){return n!=null&&typeof n=="object"&&"video"in n}function Mo(n){return n!=null&&typeof n=="object"&&"uri"in n}function _t(n){var e;let t;if(Ro(n)&&(t=n.name),!(Mo(n)&&(t=n.uri,t===void 0))&&!(Po(n)&&(t=(e=n.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof n=="string"&&(t=n),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const s=t.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${t}`);t=s[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function Ct(n,e){let t;return n.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function vt(n){for(const e of["models","tunedModels","publisherModels"])if(No(n,e))return n[e];return[]}function No(n,e){return n!==null&&typeof n=="object"&&e in n}function wo(n,e={}){const t=n,o={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(o.responseJsonSchema=t.outputSchema),e.behavior&&(o.behavior=e.behavior),{functionDeclarations:[o]}}function Do(n,e={}){const t=[],o=new Set;for(const s of n){const l=s.name;if(o.has(l))throw new Error(`Duplicate function name ${l} found in MCP tools. Please ensure function names are unique.`);o.add(l);const a=wo(s,e);a.functionDeclarations&&t.push(...a.functionDeclarations)}return{functionDeclarations:t}}function St(n,e){let t;if(typeof e=="string")if(n.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(n.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;const o=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,s=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(n.isVertexAI()){if(s>0||o!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(o>0||s!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function xo(n){if(typeof n!="string")return n;const e=n;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function It(n){if(typeof n!="object"||n===null)return{};const e=n,t=e.inlinedResponses;if(typeof t!="object"||t===null)return n;const s=t.inlinedResponses;if(!Array.isArray(s)||s.length===0)return n;let l=!1;for(const a of s){if(typeof a!="object"||a===null)continue;const f=a.response;if(typeof f!="object"||f===null)continue;if(f.embedding!==void 0){l=!0;break}}return l&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),n}function oe(n,e){const t=e;if(!n.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function At(n){const e=n;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function Uo(n){const e={},t=i(n,["responsesFile"]);t!=null&&r(e,["fileName"],t);const o=i(n,["inlinedResponses","inlinedResponses"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(a=>di(a))),r(e,["inlinedResponses"],l)}const s=i(n,["inlinedEmbedContentResponses","inlinedResponses"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(a=>a)),r(e,["inlinedEmbedContentResponses"],l)}return e}function Lo(n){const e={},t=i(n,["predictionsFormat"]);t!=null&&r(e,["format"],t);const o=i(n,["gcsDestination","outputUriPrefix"]);o!=null&&r(e,["gcsUri"],o);const s=i(n,["bigqueryDestination","outputUri"]);return s!=null&&r(e,["bigqueryUri"],s),e}function ko(n){const e={},t=i(n,["format"]);t!=null&&r(e,["predictionsFormat"],t);const o=i(n,["gcsUri"]);o!=null&&r(e,["gcsDestination","outputUriPrefix"],o);const s=i(n,["bigqueryUri"]);if(s!=null&&r(e,["bigqueryDestination","outputUri"],s),i(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(i(n,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(i(n,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function re(n){const e={},t=i(n,["name"]);t!=null&&r(e,["name"],t);const o=i(n,["metadata","displayName"]);o!=null&&r(e,["displayName"],o);const s=i(n,["metadata","state"]);s!=null&&r(e,["state"],At(s));const l=i(n,["metadata","createTime"]);l!=null&&r(e,["createTime"],l);const a=i(n,["metadata","endTime"]);a!=null&&r(e,["endTime"],a);const u=i(n,["metadata","updateTime"]);u!=null&&r(e,["updateTime"],u);const f=i(n,["metadata","model"]);f!=null&&r(e,["model"],f);const d=i(n,["metadata","output"]);return d!=null&&r(e,["dest"],Uo(It(d))),e}function Se(n){const e={},t=i(n,["name"]);t!=null&&r(e,["name"],t);const o=i(n,["displayName"]);o!=null&&r(e,["displayName"],o);const s=i(n,["state"]);s!=null&&r(e,["state"],At(s));const l=i(n,["error"]);l!=null&&r(e,["error"],l);const a=i(n,["createTime"]);a!=null&&r(e,["createTime"],a);const u=i(n,["startTime"]);u!=null&&r(e,["startTime"],u);const f=i(n,["endTime"]);f!=null&&r(e,["endTime"],f);const d=i(n,["updateTime"]);d!=null&&r(e,["updateTime"],d);const c=i(n,["model"]);c!=null&&r(e,["model"],c);const p=i(n,["inputConfig"]);p!=null&&r(e,["src"],Fo(p));const m=i(n,["outputConfig"]);m!=null&&r(e,["dest"],Lo(It(m)));const h=i(n,["completionStats"]);return h!=null&&r(e,["completionStats"],h),e}function Fo(n){const e={},t=i(n,["instancesFormat"]);t!=null&&r(e,["format"],t);const o=i(n,["gcsSource","uris"]);o!=null&&r(e,["gcsUri"],o);const s=i(n,["bigquerySource","inputUri"]);return s!=null&&r(e,["bigqueryUri"],s),e}function Vo(n,e){const t={};if(i(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(i(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(i(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const o=i(e,["fileName"]);o!=null&&r(t,["fileName"],o);const s=i(e,["inlinedRequests"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(a=>ui(n,a))),r(t,["requests","requests"],l)}return t}function Go(n){const e={},t=i(n,["format"]);t!=null&&r(e,["instancesFormat"],t);const o=i(n,["gcsUri"]);o!=null&&r(e,["gcsSource","uris"],o);const s=i(n,["bigqueryUri"]);if(s!=null&&r(e,["bigquerySource","inputUri"],s),i(n,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(i(n,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function qo(n){const e={},t=i(n,["data"]);if(t!=null&&r(e,["data"],t),i(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=i(n,["mimeType"]);return o!=null&&r(e,["mimeType"],o),e}function Ho(n,e){const t={},o=i(e,["name"]);return o!=null&&r(t,["_url","name"],oe(n,o)),t}function Bo(n,e){const t={},o=i(e,["name"]);return o!=null&&r(t,["_url","name"],oe(n,o)),t}function Jo(n){const e={},t=i(n,["content"]);t!=null&&r(e,["content"],t);const o=i(n,["citationMetadata"]);o!=null&&r(e,["citationMetadata"],$o(o));const s=i(n,["tokenCount"]);s!=null&&r(e,["tokenCount"],s);const l=i(n,["finishReason"]);l!=null&&r(e,["finishReason"],l);const a=i(n,["avgLogprobs"]);a!=null&&r(e,["avgLogprobs"],a);const u=i(n,["groundingMetadata"]);u!=null&&r(e,["groundingMetadata"],u);const f=i(n,["index"]);f!=null&&r(e,["index"],f);const d=i(n,["logprobsResult"]);d!=null&&r(e,["logprobsResult"],d);const c=i(n,["safetyRatings"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(h=>h)),r(e,["safetyRatings"],m)}const p=i(n,["urlContextMetadata"]);return p!=null&&r(e,["urlContextMetadata"],p),e}function $o(n){const e={},t=i(n,["citationSources"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>s)),r(e,["citations"],o)}return e}function Rt(n){const e={},t=i(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(l=>yi(l))),r(e,["parts"],s)}const o=i(n,["role"]);return o!=null&&r(e,["role"],o),e}function Yo(n,e){const t={},o=i(n,["displayName"]);if(e!==void 0&&o!=null&&r(e,["batch","displayName"],o),i(n,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function bo(n,e){const t={},o=i(n,["displayName"]);e!==void 0&&o!=null&&r(e,["displayName"],o);const s=i(n,["dest"]);return e!==void 0&&s!=null&&r(e,["outputConfig"],ko(xo(s))),t}function Qn(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["src"]);s!=null&&r(t,["batch","inputConfig"],Vo(n,St(n,s)));const l=i(e,["config"]);return l!=null&&Yo(l,t),t}function Wo(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["model"],M(n,o));const s=i(e,["src"]);s!=null&&r(t,["inputConfig"],Go(St(n,s)));const l=i(e,["config"]);return l!=null&&bo(l,t),t}function Ko(n,e){const t={},o=i(n,["displayName"]);return e!==void 0&&o!=null&&r(e,["batch","displayName"],o),t}function zo(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["src"]);s!=null&&r(t,["batch","inputConfig"],ni(n,s));const l=i(e,["config"]);return l!=null&&Ko(l,t),t}function Xo(n,e){const t={},o=i(e,["name"]);return o!=null&&r(t,["_url","name"],oe(n,o)),t}function Oo(n,e){const t={},o=i(e,["name"]);return o!=null&&r(t,["_url","name"],oe(n,o)),t}function Qo(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["name"]);o!=null&&r(e,["name"],o);const s=i(n,["done"]);s!=null&&r(e,["done"],s);const l=i(n,["error"]);return l!=null&&r(e,["error"],l),e}function Zo(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["name"]);o!=null&&r(e,["name"],o);const s=i(n,["done"]);s!=null&&r(e,["done"],s);const l=i(n,["error"]);return l!=null&&r(e,["error"],l),e}function jo(n,e){const t={},o=i(e,["contents"]);if(o!=null){let l=Ue(n,o);Array.isArray(l)&&(l=l.map(a=>a)),r(t,["requests[]","request","content"],l)}const s=i(e,["config"]);return s!=null&&(r(t,["_self"],ei(s,t)),Xt(t,{"requests[].*":"requests[].request.*"})),t}function ei(n,e){const t={},o=i(n,["taskType"]);e!==void 0&&o!=null&&r(e,["requests[]","taskType"],o);const s=i(n,["title"]);e!==void 0&&s!=null&&r(e,["requests[]","title"],s);const l=i(n,["outputDimensionality"]);if(e!==void 0&&l!=null&&r(e,["requests[]","outputDimensionality"],l),i(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(i(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function ni(n,e){const t={},o=i(e,["fileName"]);o!=null&&r(t,["file_name"],o);const s=i(e,["inlinedRequests"]);return s!=null&&r(t,["requests"],jo(n,s)),t}function ti(n){const e={};if(i(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=i(n,["fileUri"]);t!=null&&r(e,["fileUri"],t);const o=i(n,["mimeType"]);return o!=null&&r(e,["mimeType"],o),e}function oi(n,e,t){const o={},s=i(e,["systemInstruction"]);t!==void 0&&s!=null&&r(t,["systemInstruction"],Rt(V(s)));const l=i(e,["temperature"]);l!=null&&r(o,["temperature"],l);const a=i(e,["topP"]);a!=null&&r(o,["topP"],a);const u=i(e,["topK"]);u!=null&&r(o,["topK"],u);const f=i(e,["candidateCount"]);f!=null&&r(o,["candidateCount"],f);const d=i(e,["maxOutputTokens"]);d!=null&&r(o,["maxOutputTokens"],d);const c=i(e,["stopSequences"]);c!=null&&r(o,["stopSequences"],c);const p=i(e,["responseLogprobs"]);p!=null&&r(o,["responseLogprobs"],p);const m=i(e,["logprobs"]);m!=null&&r(o,["logprobs"],m);const h=i(e,["presencePenalty"]);h!=null&&r(o,["presencePenalty"],h);const g=i(e,["frequencyPenalty"]);g!=null&&r(o,["frequencyPenalty"],g);const y=i(e,["seed"]);y!=null&&r(o,["seed"],y);const _=i(e,["responseMimeType"]);_!=null&&r(o,["responseMimeType"],_);const C=i(e,["responseSchema"]);C!=null&&r(o,["responseSchema"],Le(C));const v=i(e,["responseJsonSchema"]);if(v!=null&&r(o,["responseJsonSchema"],v),i(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(i(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const E=i(e,["safetySettings"]);if(t!==void 0&&E!=null){let D=E;Array.isArray(D)&&(D=D.map(Y=>Ti(Y))),r(t,["safetySettings"],D)}const S=i(e,["tools"]);if(t!==void 0&&S!=null){let D=te(S);Array.isArray(D)&&(D=D.map(Y=>Ei(ne(Y)))),r(t,["tools"],D)}const A=i(e,["toolConfig"]);if(t!==void 0&&A!=null&&r(t,["toolConfig"],A),i(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const R=i(e,["cachedContent"]);t!==void 0&&R!=null&&r(t,["cachedContent"],z(n,R));const P=i(e,["responseModalities"]);P!=null&&r(o,["responseModalities"],P);const F=i(e,["mediaResolution"]);F!=null&&r(o,["mediaResolution"],F);const I=i(e,["speechConfig"]);if(I!=null&&r(o,["speechConfig"],ke(I)),i(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const N=i(e,["thinkingConfig"]);N!=null&&r(o,["thinkingConfig"],N);const L=i(e,["imageConfig"]);return L!=null&&r(o,["imageConfig"],L),o}function ii(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["candidates"]);if(o!=null){let f=o;Array.isArray(f)&&(f=f.map(d=>Jo(d))),r(e,["candidates"],f)}const s=i(n,["modelVersion"]);s!=null&&r(e,["modelVersion"],s);const l=i(n,["promptFeedback"]);l!=null&&r(e,["promptFeedback"],l);const a=i(n,["responseId"]);a!=null&&r(e,["responseId"],a);const u=i(n,["usageMetadata"]);return u!=null&&r(e,["usageMetadata"],u),e}function si(n,e){const t={},o=i(e,["name"]);return o!=null&&r(t,["_url","name"],oe(n,o)),t}function ri(n,e){const t={},o=i(e,["name"]);return o!=null&&r(t,["_url","name"],oe(n,o)),t}function li(n){const e={};if(i(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=i(n,["enableWidget"]);return t!=null&&r(e,["enableWidget"],t),e}function ai(n){const e={};if(i(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(i(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=i(n,["timeRangeFilter"]);return t!=null&&r(e,["timeRangeFilter"],t),e}function ui(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["request","model"],M(n,o));const s=i(e,["contents"]);if(s!=null){let u=B(s);Array.isArray(u)&&(u=u.map(f=>Rt(f))),r(t,["request","contents"],u)}const l=i(e,["metadata"]);l!=null&&r(t,["metadata"],l);const a=i(e,["config"]);return a!=null&&r(t,["request","generationConfig"],oi(n,a,i(t,["request"],{}))),t}function di(n){const e={},t=i(n,["response"]);t!=null&&r(e,["response"],ii(t));const o=i(n,["error"]);return o!=null&&r(e,["error"],o),e}function fi(n,e){const t={},o=i(n,["pageSize"]);e!==void 0&&o!=null&&r(e,["_query","pageSize"],o);const s=i(n,["pageToken"]);if(e!==void 0&&s!=null&&r(e,["_query","pageToken"],s),i(n,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function ci(n,e){const t={},o=i(n,["pageSize"]);e!==void 0&&o!=null&&r(e,["_query","pageSize"],o);const s=i(n,["pageToken"]);e!==void 0&&s!=null&&r(e,["_query","pageToken"],s);const l=i(n,["filter"]);return e!==void 0&&l!=null&&r(e,["_query","filter"],l),t}function pi(n){const e={},t=i(n,["config"]);return t!=null&&fi(t,e),e}function mi(n){const e={},t=i(n,["config"]);return t!=null&&ci(t,e),e}function hi(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["nextPageToken"]);o!=null&&r(e,["nextPageToken"],o);const s=i(n,["operations"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(a=>re(a))),r(e,["batchJobs"],l)}return e}function gi(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["nextPageToken"]);o!=null&&r(e,["nextPageToken"],o);const s=i(n,["batchPredictionJobs"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(a=>Se(a))),r(e,["batchJobs"],l)}return e}function yi(n){const e={},t=i(n,["functionCall"]);t!=null&&r(e,["functionCall"],t);const o=i(n,["codeExecutionResult"]);o!=null&&r(e,["codeExecutionResult"],o);const s=i(n,["executableCode"]);s!=null&&r(e,["executableCode"],s);const l=i(n,["fileData"]);l!=null&&r(e,["fileData"],ti(l));const a=i(n,["functionResponse"]);a!=null&&r(e,["functionResponse"],a);const u=i(n,["inlineData"]);u!=null&&r(e,["inlineData"],qo(u));const f=i(n,["text"]);f!=null&&r(e,["text"],f);const d=i(n,["thought"]);d!=null&&r(e,["thought"],d);const c=i(n,["thoughtSignature"]);c!=null&&r(e,["thoughtSignature"],c);const p=i(n,["videoMetadata"]);return p!=null&&r(e,["videoMetadata"],p),e}function Ti(n){const e={},t=i(n,["category"]);if(t!=null&&r(e,["category"],t),i(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const o=i(n,["threshold"]);return o!=null&&r(e,["threshold"],o),e}function Ei(n){const e={},t=i(n,["functionDeclarations"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(p=>p)),r(e,["functionDeclarations"],c)}if(i(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=i(n,["googleSearchRetrieval"]);o!=null&&r(e,["googleSearchRetrieval"],o);const s=i(n,["computerUse"]);s!=null&&r(e,["computerUse"],s);const l=i(n,["fileSearch"]);l!=null&&r(e,["fileSearch"],l);const a=i(n,["codeExecution"]);if(a!=null&&r(e,["codeExecution"],a),i(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=i(n,["googleMaps"]);u!=null&&r(e,["googleMaps"],li(u));const f=i(n,["googleSearch"]);f!=null&&r(e,["googleSearch"],ai(f));const d=i(n,["urlContext"]);return d!=null&&r(e,["urlContext"],d),e}var W;(function(n){n.PAGED_ITEM_BATCH_JOBS="batchJobs",n.PAGED_ITEM_MODELS="models",n.PAGED_ITEM_TUNING_JOBS="tuningJobs",n.PAGED_ITEM_FILES="files",n.PAGED_ITEM_CACHED_CONTENTS="cachedContents",n.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",n.PAGED_ITEM_DOCUMENTS="documents"})(W||(W={}));class O{constructor(e,t,o,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,o,s)}init(e,t,o){var s,l;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t?.sdkHttpResponse,this.idxInternal=0;let a={config:{}};!o||Object.keys(o).length===0?a={config:{}}:typeof o=="object"?a=Object.assign({},o):a=o,a.config&&(a.config.pageToken=t.nextPageToken),this.paramsInternal=a,this.pageInternalSize=(l=(s=a.config)===null||s===void 0?void 0:s.pageSize)!==null&&l!==void 0?l:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}class _i extends K{constructor(e){super(),this.apiClient=e,this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)},this.list=async(t={})=>new O(W.PAGED_ITEM_BATCH_JOBS,o=>this.listInternal(o),await this.listInternal(t),t)}createInlinedGenerateContentRequest(e){const t=Qn(this.apiClient,e),o=t._url,s=T("{model}:batchGenerateContent",o),u=t.batch.inputConfig.requests,f=u.requests,d=[];for(const c of f){const p=Object.assign({},c);if(p.systemInstruction){const m=p.systemInstruction;delete p.systemInstruction;const h=p.request;h.systemInstruction=m,p.request=h}d.push(p)}return u.requests=d,delete t.config,delete t._url,delete t._query,{path:s,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){const o=t?Object.assign({},t):{},s=Date.now().toString();if(o.displayName||(o.displayName=`genaiBatchJob_${s}`),o.dest===void 0){const l=this.getGcsUri(e),a=this.getBigqueryUri(e);if(l)l.endsWith(".jsonl")?o.dest=`${l.slice(0,-6)}/dest`:o.dest=`${l}_dest_${s}`;else if(a)o.dest=`${a}_dest_${s}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return o}async createInternal(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=Wo(this.apiClient,e);return u=T("batchPredictionJobs",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json()),a.then(c=>Se(c))}else{const d=Qn(this.apiClient,e);return u=T("{model}:batchGenerateContent",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json()),a.then(c=>re(c))}}async createEmbeddingsInternal(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=zo(this.apiClient,e);return l=T("{model}:asyncBatchEmbedContent",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),s.then(f=>re(f))}}async get(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=ri(this.apiClient,e);return u=T("batchPredictionJobs/{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json()),a.then(c=>Se(c))}else{const d=si(this.apiClient,e);return u=T("batches/{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json()),a.then(c=>re(c))}}async cancel(e){var t,o,s,l;let a="",u={};if(this.apiClient.isVertexAI()){const f=Bo(this.apiClient,e);a=T("batchPredictionJobs/{name}:cancel",f._url),u=f._query,delete f._url,delete f._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}else{const f=Ho(this.apiClient,e);a=T("batches/{name}:cancel",f._url),u=f._query,delete f._url,delete f._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal})}}async listInternal(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=mi(e);return u=T("batchPredictionJobs",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=gi(c),m=new Kn;return Object.assign(m,p),m})}else{const d=pi(e);return u=T("batches",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=hi(c),m=new Kn;return Object.assign(m,p),m})}}async delete(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=Oo(this.apiClient,e);return u=T("batchPredictionJobs/{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>Zo(c))}else{const d=Xo(this.apiClient,e);return u=T("batches/{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>Qo(c))}}}function Ci(n){const e={},t=i(n,["data"]);if(t!=null&&r(e,["data"],t),i(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=i(n,["mimeType"]);return o!=null&&r(e,["mimeType"],o),e}function Zn(n){const e={},t=i(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(l=>Ji(l))),r(e,["parts"],s)}const o=i(n,["role"]);return o!=null&&r(e,["role"],o),e}function vi(n,e){const t={},o=i(n,["ttl"]);e!==void 0&&o!=null&&r(e,["ttl"],o);const s=i(n,["expireTime"]);e!==void 0&&s!=null&&r(e,["expireTime"],s);const l=i(n,["displayName"]);e!==void 0&&l!=null&&r(e,["displayName"],l);const a=i(n,["contents"]);if(e!==void 0&&a!=null){let c=B(a);Array.isArray(c)&&(c=c.map(p=>Zn(p))),r(e,["contents"],c)}const u=i(n,["systemInstruction"]);e!==void 0&&u!=null&&r(e,["systemInstruction"],Zn(V(u)));const f=i(n,["tools"]);if(e!==void 0&&f!=null){let c=f;Array.isArray(c)&&(c=c.map(p=>$i(p))),r(e,["tools"],c)}const d=i(n,["toolConfig"]);if(e!==void 0&&d!=null&&r(e,["toolConfig"],d),i(n,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function Si(n,e){const t={},o=i(n,["ttl"]);e!==void 0&&o!=null&&r(e,["ttl"],o);const s=i(n,["expireTime"]);e!==void 0&&s!=null&&r(e,["expireTime"],s);const l=i(n,["displayName"]);e!==void 0&&l!=null&&r(e,["displayName"],l);const a=i(n,["contents"]);if(e!==void 0&&a!=null){let p=B(a);Array.isArray(p)&&(p=p.map(m=>m)),r(e,["contents"],p)}const u=i(n,["systemInstruction"]);e!==void 0&&u!=null&&r(e,["systemInstruction"],V(u));const f=i(n,["tools"]);if(e!==void 0&&f!=null){let p=f;Array.isArray(p)&&(p=p.map(m=>Yi(m))),r(e,["tools"],p)}const d=i(n,["toolConfig"]);e!==void 0&&d!=null&&r(e,["toolConfig"],d);const c=i(n,["kmsKeyName"]);return e!==void 0&&c!=null&&r(e,["encryption_spec","kmsKeyName"],c),t}function Ii(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["model"],mt(n,o));const s=i(e,["config"]);return s!=null&&vi(s,t),t}function Ai(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["model"],mt(n,o));const s=i(e,["config"]);return s!=null&&Si(s,t),t}function Ri(n,e){const t={},o=i(e,["name"]);return o!=null&&r(t,["_url","name"],z(n,o)),t}function Pi(n,e){const t={},o=i(e,["name"]);return o!=null&&r(t,["_url","name"],z(n,o)),t}function Mi(n){const e={},t=i(n,["sdkHttpResponse"]);return t!=null&&r(e,["sdkHttpResponse"],t),e}function Ni(n){const e={},t=i(n,["sdkHttpResponse"]);return t!=null&&r(e,["sdkHttpResponse"],t),e}function wi(n){const e={};if(i(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=i(n,["fileUri"]);t!=null&&r(e,["fileUri"],t);const o=i(n,["mimeType"]);return o!=null&&r(e,["mimeType"],o),e}function Di(n){const e={};if(i(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=i(n,["description"]);t!=null&&r(e,["description"],t);const o=i(n,["name"]);o!=null&&r(e,["name"],o);const s=i(n,["parameters"]);s!=null&&r(e,["parameters"],s);const l=i(n,["parametersJsonSchema"]);l!=null&&r(e,["parametersJsonSchema"],l);const a=i(n,["response"]);a!=null&&r(e,["response"],a);const u=i(n,["responseJsonSchema"]);return u!=null&&r(e,["responseJsonSchema"],u),e}function xi(n,e){const t={},o=i(e,["name"]);return o!=null&&r(t,["_url","name"],z(n,o)),t}function Ui(n,e){const t={},o=i(e,["name"]);return o!=null&&r(t,["_url","name"],z(n,o)),t}function Li(n){const e={};if(i(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=i(n,["enableWidget"]);return t!=null&&r(e,["enableWidget"],t),e}function ki(n){const e={};if(i(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(i(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=i(n,["timeRangeFilter"]);return t!=null&&r(e,["timeRangeFilter"],t),e}function Fi(n,e){const t={},o=i(n,["pageSize"]);e!==void 0&&o!=null&&r(e,["_query","pageSize"],o);const s=i(n,["pageToken"]);return e!==void 0&&s!=null&&r(e,["_query","pageToken"],s),t}function Vi(n,e){const t={},o=i(n,["pageSize"]);e!==void 0&&o!=null&&r(e,["_query","pageSize"],o);const s=i(n,["pageToken"]);return e!==void 0&&s!=null&&r(e,["_query","pageToken"],s),t}function Gi(n){const e={},t=i(n,["config"]);return t!=null&&Fi(t,e),e}function qi(n){const e={},t=i(n,["config"]);return t!=null&&Vi(t,e),e}function Hi(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["nextPageToken"]);o!=null&&r(e,["nextPageToken"],o);const s=i(n,["cachedContents"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(a=>a)),r(e,["cachedContents"],l)}return e}function Bi(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["nextPageToken"]);o!=null&&r(e,["nextPageToken"],o);const s=i(n,["cachedContents"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(a=>a)),r(e,["cachedContents"],l)}return e}function Ji(n){const e={},t=i(n,["functionCall"]);t!=null&&r(e,["functionCall"],t);const o=i(n,["codeExecutionResult"]);o!=null&&r(e,["codeExecutionResult"],o);const s=i(n,["executableCode"]);s!=null&&r(e,["executableCode"],s);const l=i(n,["fileData"]);l!=null&&r(e,["fileData"],wi(l));const a=i(n,["functionResponse"]);a!=null&&r(e,["functionResponse"],a);const u=i(n,["inlineData"]);u!=null&&r(e,["inlineData"],Ci(u));const f=i(n,["text"]);f!=null&&r(e,["text"],f);const d=i(n,["thought"]);d!=null&&r(e,["thought"],d);const c=i(n,["thoughtSignature"]);c!=null&&r(e,["thoughtSignature"],c);const p=i(n,["videoMetadata"]);return p!=null&&r(e,["videoMetadata"],p),e}function $i(n){const e={},t=i(n,["functionDeclarations"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(p=>p)),r(e,["functionDeclarations"],c)}if(i(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=i(n,["googleSearchRetrieval"]);o!=null&&r(e,["googleSearchRetrieval"],o);const s=i(n,["computerUse"]);s!=null&&r(e,["computerUse"],s);const l=i(n,["fileSearch"]);l!=null&&r(e,["fileSearch"],l);const a=i(n,["codeExecution"]);if(a!=null&&r(e,["codeExecution"],a),i(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=i(n,["googleMaps"]);u!=null&&r(e,["googleMaps"],Li(u));const f=i(n,["googleSearch"]);f!=null&&r(e,["googleSearch"],ki(f));const d=i(n,["urlContext"]);return d!=null&&r(e,["urlContext"],d),e}function Yi(n){const e={},t=i(n,["functionDeclarations"]);if(t!=null){let p=t;Array.isArray(p)&&(p=p.map(m=>Di(m))),r(e,["functionDeclarations"],p)}const o=i(n,["retrieval"]);o!=null&&r(e,["retrieval"],o);const s=i(n,["googleSearchRetrieval"]);s!=null&&r(e,["googleSearchRetrieval"],s);const l=i(n,["computerUse"]);if(l!=null&&r(e,["computerUse"],l),i(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=i(n,["codeExecution"]);a!=null&&r(e,["codeExecution"],a);const u=i(n,["enterpriseWebSearch"]);u!=null&&r(e,["enterpriseWebSearch"],u);const f=i(n,["googleMaps"]);f!=null&&r(e,["googleMaps"],f);const d=i(n,["googleSearch"]);d!=null&&r(e,["googleSearch"],d);const c=i(n,["urlContext"]);return c!=null&&r(e,["urlContext"],c),e}function bi(n,e){const t={},o=i(n,["ttl"]);e!==void 0&&o!=null&&r(e,["ttl"],o);const s=i(n,["expireTime"]);return e!==void 0&&s!=null&&r(e,["expireTime"],s),t}function Wi(n,e){const t={},o=i(n,["ttl"]);e!==void 0&&o!=null&&r(e,["ttl"],o);const s=i(n,["expireTime"]);return e!==void 0&&s!=null&&r(e,["expireTime"],s),t}function Ki(n,e){const t={},o=i(e,["name"]);o!=null&&r(t,["_url","name"],z(n,o));const s=i(e,["config"]);return s!=null&&bi(s,t),t}function zi(n,e){const t={},o=i(e,["name"]);o!=null&&r(t,["_url","name"],z(n,o));const s=i(e,["config"]);return s!=null&&Wi(s,t),t}class Xi extends K{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new O(W.PAGED_ITEM_CACHED_CONTENTS,o=>this.listInternal(o),await this.listInternal(t),t)}async create(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=Ai(this.apiClient,e);return u=T("cachedContents",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json()),a.then(c=>c)}else{const d=Ii(this.apiClient,e);return u=T("cachedContents",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async get(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=Ui(this.apiClient,e);return u=T("{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json()),a.then(c=>c)}else{const d=xi(this.apiClient,e);return u=T("{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async delete(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=Pi(this.apiClient,e);return u=T("{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=Ni(c),m=new bn;return Object.assign(m,p),m})}else{const d=Ri(this.apiClient,e);return u=T("{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=Mi(c),m=new bn;return Object.assign(m,p),m})}}async update(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=zi(this.apiClient,e);return u=T("{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json()),a.then(c=>c)}else{const d=Ki(this.apiClient,e);return u=T("{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json()),a.then(c=>c)}}async listInternal(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=qi(e);return u=T("cachedContents",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=Bi(c),m=new Wn;return Object.assign(m,p),m})}else{const d=Gi(e);return u=T("cachedContents",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=Hi(c),m=new Wn;return Object.assign(m,p),m})}}}function jn(n){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&n[e],o=0;if(t)return t.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&o>=n.length&&(n=void 0),{value:n&&n[o++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function w(n){return this instanceof w?(this.v=n,this):new w(n)}function j(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var o=t.apply(n,e||[]),s,l=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",a),s[Symbol.asyncIterator]=function(){return this},s;function a(h){return function(g){return Promise.resolve(g).then(h,p)}}function u(h,g){o[h]&&(s[h]=function(y){return new Promise(function(_,C){l.push([h,y,_,C])>1||f(h,y)})},g&&(s[h]=g(s[h])))}function f(h,g){try{d(o[h](g))}catch(y){m(l[0][3],y)}}function d(h){h.value instanceof w?Promise.resolve(h.value.v).then(c,p):m(l[0][2],h)}function c(h){f("next",h)}function p(h){f("throw",h)}function m(h,g){h(g),l.shift(),l.length&&f(l[0][0],l[0][1])}}function se(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof jn=="function"?jn(n):n[Symbol.iterator](),t={},o("next"),o("throw"),o("return"),t[Symbol.asyncIterator]=function(){return this},t);function o(l){t[l]=n[l]&&function(a){return new Promise(function(u,f){a=n[l](a),s(u,f,a.done,a.value)})}}function s(l,a,u,f){Promise.resolve(f).then(function(d){l({value:d,done:u})},a)}}function Oi(n){var e;if(n.candidates==null||n.candidates.length===0)return!1;const t=(e=n.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:Pt(t)}function Pt(n){if(n.parts===void 0||n.parts.length===0)return!1;for(const e of n.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function Qi(n){if(n.length!==0){for(const e of n)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function et(n){if(n===void 0||n.length===0)return[];const e=[],t=n.length;let o=0;for(;o<t;)if(n[o].role==="user")e.push(n[o]),o++;else{const s=[];let l=!0;for(;o<t&&n[o].role==="model";)s.push(n[o]),l&&!Pt(n[o])&&(l=!1),o++;l?e.push(...s):e.pop()}return e}class Zi{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new ji(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class ji{constructor(e,t,o,s={},l=[]){this.apiClient=e,this.modelsModule=t,this.model=o,this.config=s,this.history=l,this.sendPromise=Promise.resolve(),Qi(l)}async sendMessage(e){var t;await this.sendPromise;const o=V(e.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(o),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var l,a,u;const f=await s,d=(a=(l=f.candidates)===null||l===void 0?void 0:l[0])===null||a===void 0?void 0:a.content,c=f.automaticFunctionCallingHistory,p=this.getHistory(!0).length;let m=[];c!=null&&(m=(u=c.slice(p))!==null&&u!==void 0?u:[]);const h=d?[d]:[];this.recordHistory(o,h,m)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),s}async sendMessageStream(e){var t;await this.sendPromise;const o=V(e.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(o),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});const l=await s;return this.processStreamResponse(l,o)}getHistory(e=!1){const t=e?et(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){var o,s;return j(this,arguments,function*(){var a,u,f,d;const c=[];try{for(var p=!0,m=se(e),h;h=yield w(m.next()),a=h.done,!a;p=!0){d=h.value,p=!1;const g=d;if(Oi(g)){const y=(s=(o=g.candidates)===null||o===void 0?void 0:o[0])===null||s===void 0?void 0:s.content;y!==void 0&&c.push(y)}yield yield w(g)}}catch(g){u={error:g}}finally{try{!p&&!a&&(f=m.return)&&(yield w(f.call(m)))}finally{if(u)throw u.error}}this.recordHistory(t,c)})}recordHistory(e,t,o){let s=[];t.length>0&&t.every(l=>l.role!==void 0)?s=t:s.push({role:"model",parts:[]}),o&&o.length>0?this.history.push(...et(o)):this.history.push(e),this.history.push(...s)}}class pe extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,pe.prototype)}}function es(n){const e={},t=i(n,["file"]);return t!=null&&r(e,["file"],t),e}function ns(n){const e={},t=i(n,["sdkHttpResponse"]);return t!=null&&r(e,["sdkHttpResponse"],t),e}function ts(n){const e={},t=i(n,["name"]);return t!=null&&r(e,["_url","file"],_t(t)),e}function os(n){const e={},t=i(n,["sdkHttpResponse"]);return t!=null&&r(e,["sdkHttpResponse"],t),e}function is(n){const e={},t=i(n,["name"]);return t!=null&&r(e,["_url","file"],_t(t)),e}function ss(n,e){const t={},o=i(n,["pageSize"]);e!==void 0&&o!=null&&r(e,["_query","pageSize"],o);const s=i(n,["pageToken"]);return e!==void 0&&s!=null&&r(e,["_query","pageToken"],s),t}function rs(n){const e={},t=i(n,["config"]);return t!=null&&ss(t,e),e}function ls(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["nextPageToken"]);o!=null&&r(e,["nextPageToken"],o);const s=i(n,["files"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(a=>a)),r(e,["files"],l)}return e}class as extends K{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new O(W.PAGED_ITEM_FILES,o=>this.listInternal(o),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=rs(e);return l=T("files",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(d=>{const c=d;return c.sdkHttpResponse={headers:f.headers},c})),s.then(f=>{const d=ls(f),c=new Eo;return Object.assign(c,d),c})}}async createInternal(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=es(e);return l=T("upload/v1beta/files",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),s.then(f=>{const d=ns(f),c=new _o;return Object.assign(c,d),c})}}async get(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=is(e);return l=T("files/{file}",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),s.then(f=>f)}}async delete(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=ts(e);return l=T("files/{file}",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(d=>{const c=d;return c.sdkHttpResponse={headers:f.headers},c})),s.then(f=>{const d=os(f),c=new Co;return Object.assign(c,d),c})}}}function le(n){const e={},t=i(n,["data"]);if(t!=null&&r(e,["data"],t),i(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=i(n,["mimeType"]);return o!=null&&r(e,["mimeType"],o),e}function us(n){const e={},t=i(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(l=>Is(l))),r(e,["parts"],s)}const o=i(n,["role"]);return o!=null&&r(e,["role"],o),e}function ds(n){const e={};if(i(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=i(n,["fileUri"]);t!=null&&r(e,["fileUri"],t);const o=i(n,["mimeType"]);return o!=null&&r(e,["mimeType"],o),e}function fs(n){const e={};if(i(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=i(n,["description"]);t!=null&&r(e,["description"],t);const o=i(n,["name"]);o!=null&&r(e,["name"],o);const s=i(n,["parameters"]);s!=null&&r(e,["parameters"],s);const l=i(n,["parametersJsonSchema"]);l!=null&&r(e,["parametersJsonSchema"],l);const a=i(n,["response"]);a!=null&&r(e,["response"],a);const u=i(n,["responseJsonSchema"]);return u!=null&&r(e,["responseJsonSchema"],u),e}function cs(n){const e={},t=i(n,["modelSelectionConfig"]);t!=null&&r(e,["modelConfig"],t);const o=i(n,["responseJsonSchema"]);o!=null&&r(e,["responseJsonSchema"],o);const s=i(n,["audioTimestamp"]);s!=null&&r(e,["audioTimestamp"],s);const l=i(n,["candidateCount"]);l!=null&&r(e,["candidateCount"],l);const a=i(n,["enableAffectiveDialog"]);a!=null&&r(e,["enableAffectiveDialog"],a);const u=i(n,["frequencyPenalty"]);u!=null&&r(e,["frequencyPenalty"],u);const f=i(n,["logprobs"]);f!=null&&r(e,["logprobs"],f);const d=i(n,["maxOutputTokens"]);d!=null&&r(e,["maxOutputTokens"],d);const c=i(n,["mediaResolution"]);c!=null&&r(e,["mediaResolution"],c);const p=i(n,["presencePenalty"]);p!=null&&r(e,["presencePenalty"],p);const m=i(n,["responseLogprobs"]);m!=null&&r(e,["responseLogprobs"],m);const h=i(n,["responseMimeType"]);h!=null&&r(e,["responseMimeType"],h);const g=i(n,["responseModalities"]);g!=null&&r(e,["responseModalities"],g);const y=i(n,["responseSchema"]);y!=null&&r(e,["responseSchema"],y);const _=i(n,["routingConfig"]);_!=null&&r(e,["routingConfig"],_);const C=i(n,["seed"]);C!=null&&r(e,["seed"],C);const v=i(n,["speechConfig"]);v!=null&&r(e,["speechConfig"],Mt(v));const E=i(n,["stopSequences"]);E!=null&&r(e,["stopSequences"],E);const S=i(n,["temperature"]);S!=null&&r(e,["temperature"],S);const A=i(n,["thinkingConfig"]);A!=null&&r(e,["thinkingConfig"],A);const R=i(n,["topK"]);R!=null&&r(e,["topK"],R);const P=i(n,["topP"]);if(P!=null&&r(e,["topP"],P),i(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function ps(n){const e={};if(i(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=i(n,["enableWidget"]);return t!=null&&r(e,["enableWidget"],t),e}function ms(n){const e={};if(i(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(i(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=i(n,["timeRangeFilter"]);return t!=null&&r(e,["timeRangeFilter"],t),e}function hs(n,e){const t={},o=i(n,["generationConfig"]);e!==void 0&&o!=null&&r(e,["setup","generationConfig"],o);const s=i(n,["responseModalities"]);e!==void 0&&s!=null&&r(e,["setup","generationConfig","responseModalities"],s);const l=i(n,["temperature"]);e!==void 0&&l!=null&&r(e,["setup","generationConfig","temperature"],l);const a=i(n,["topP"]);e!==void 0&&a!=null&&r(e,["setup","generationConfig","topP"],a);const u=i(n,["topK"]);e!==void 0&&u!=null&&r(e,["setup","generationConfig","topK"],u);const f=i(n,["maxOutputTokens"]);e!==void 0&&f!=null&&r(e,["setup","generationConfig","maxOutputTokens"],f);const d=i(n,["mediaResolution"]);e!==void 0&&d!=null&&r(e,["setup","generationConfig","mediaResolution"],d);const c=i(n,["seed"]);e!==void 0&&c!=null&&r(e,["setup","generationConfig","seed"],c);const p=i(n,["speechConfig"]);e!==void 0&&p!=null&&r(e,["setup","generationConfig","speechConfig"],Fe(p));const m=i(n,["thinkingConfig"]);e!==void 0&&m!=null&&r(e,["setup","generationConfig","thinkingConfig"],m);const h=i(n,["enableAffectiveDialog"]);e!==void 0&&h!=null&&r(e,["setup","generationConfig","enableAffectiveDialog"],h);const g=i(n,["systemInstruction"]);e!==void 0&&g!=null&&r(e,["setup","systemInstruction"],us(V(g)));const y=i(n,["tools"]);if(e!==void 0&&y!=null){let R=te(y);Array.isArray(R)&&(R=R.map(P=>Rs(ne(P)))),r(e,["setup","tools"],R)}const _=i(n,["sessionResumption"]);e!==void 0&&_!=null&&r(e,["setup","sessionResumption"],As(_));const C=i(n,["inputAudioTranscription"]);e!==void 0&&C!=null&&r(e,["setup","inputAudioTranscription"],C);const v=i(n,["outputAudioTranscription"]);e!==void 0&&v!=null&&r(e,["setup","outputAudioTranscription"],v);const E=i(n,["realtimeInputConfig"]);e!==void 0&&E!=null&&r(e,["setup","realtimeInputConfig"],E);const S=i(n,["contextWindowCompression"]);e!==void 0&&S!=null&&r(e,["setup","contextWindowCompression"],S);const A=i(n,["proactivity"]);return e!==void 0&&A!=null&&r(e,["setup","proactivity"],A),t}function gs(n,e){const t={},o=i(n,["generationConfig"]);e!==void 0&&o!=null&&r(e,["setup","generationConfig"],cs(o));const s=i(n,["responseModalities"]);e!==void 0&&s!=null&&r(e,["setup","generationConfig","responseModalities"],s);const l=i(n,["temperature"]);e!==void 0&&l!=null&&r(e,["setup","generationConfig","temperature"],l);const a=i(n,["topP"]);e!==void 0&&a!=null&&r(e,["setup","generationConfig","topP"],a);const u=i(n,["topK"]);e!==void 0&&u!=null&&r(e,["setup","generationConfig","topK"],u);const f=i(n,["maxOutputTokens"]);e!==void 0&&f!=null&&r(e,["setup","generationConfig","maxOutputTokens"],f);const d=i(n,["mediaResolution"]);e!==void 0&&d!=null&&r(e,["setup","generationConfig","mediaResolution"],d);const c=i(n,["seed"]);e!==void 0&&c!=null&&r(e,["setup","generationConfig","seed"],c);const p=i(n,["speechConfig"]);e!==void 0&&p!=null&&r(e,["setup","generationConfig","speechConfig"],Mt(Fe(p)));const m=i(n,["thinkingConfig"]);e!==void 0&&m!=null&&r(e,["setup","generationConfig","thinkingConfig"],m);const h=i(n,["enableAffectiveDialog"]);e!==void 0&&h!=null&&r(e,["setup","generationConfig","enableAffectiveDialog"],h);const g=i(n,["systemInstruction"]);e!==void 0&&g!=null&&r(e,["setup","systemInstruction"],V(g));const y=i(n,["tools"]);if(e!==void 0&&y!=null){let R=te(y);Array.isArray(R)&&(R=R.map(P=>Ps(ne(P)))),r(e,["setup","tools"],R)}const _=i(n,["sessionResumption"]);e!==void 0&&_!=null&&r(e,["setup","sessionResumption"],_);const C=i(n,["inputAudioTranscription"]);e!==void 0&&C!=null&&r(e,["setup","inputAudioTranscription"],C);const v=i(n,["outputAudioTranscription"]);e!==void 0&&v!=null&&r(e,["setup","outputAudioTranscription"],v);const E=i(n,["realtimeInputConfig"]);e!==void 0&&E!=null&&r(e,["setup","realtimeInputConfig"],E);const S=i(n,["contextWindowCompression"]);e!==void 0&&S!=null&&r(e,["setup","contextWindowCompression"],S);const A=i(n,["proactivity"]);return e!==void 0&&A!=null&&r(e,["setup","proactivity"],A),t}function ys(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["setup","model"],M(n,o));const s=i(e,["config"]);return s!=null&&r(t,["config"],hs(s,t)),t}function Ts(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["setup","model"],M(n,o));const s=i(e,["config"]);return s!=null&&r(t,["config"],gs(s,t)),t}function Es(n){const e={},t=i(n,["musicGenerationConfig"]);return t!=null&&r(e,["musicGenerationConfig"],t),e}function _s(n){const e={},t=i(n,["weightedPrompts"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>s)),r(e,["weightedPrompts"],o)}return e}function Cs(n){const e={},t=i(n,["media"]);if(t!=null){let d=ht(t);Array.isArray(d)&&(d=d.map(c=>le(c))),r(e,["mediaChunks"],d)}const o=i(n,["audio"]);o!=null&&r(e,["audio"],le(yt(o)));const s=i(n,["audioStreamEnd"]);s!=null&&r(e,["audioStreamEnd"],s);const l=i(n,["video"]);l!=null&&r(e,["video"],le(gt(l)));const a=i(n,["text"]);a!=null&&r(e,["text"],a);const u=i(n,["activityStart"]);u!=null&&r(e,["activityStart"],u);const f=i(n,["activityEnd"]);return f!=null&&r(e,["activityEnd"],f),e}function vs(n){const e={},t=i(n,["media"]);if(t!=null){let d=ht(t);Array.isArray(d)&&(d=d.map(c=>c)),r(e,["mediaChunks"],d)}const o=i(n,["audio"]);o!=null&&r(e,["audio"],yt(o));const s=i(n,["audioStreamEnd"]);s!=null&&r(e,["audioStreamEnd"],s);const l=i(n,["video"]);l!=null&&r(e,["video"],gt(l));const a=i(n,["text"]);a!=null&&r(e,["text"],a);const u=i(n,["activityStart"]);u!=null&&r(e,["activityStart"],u);const f=i(n,["activityEnd"]);return f!=null&&r(e,["activityEnd"],f),e}function Ss(n){const e={},t=i(n,["setupComplete"]);t!=null&&r(e,["setupComplete"],t);const o=i(n,["serverContent"]);o!=null&&r(e,["serverContent"],o);const s=i(n,["toolCall"]);s!=null&&r(e,["toolCall"],s);const l=i(n,["toolCallCancellation"]);l!=null&&r(e,["toolCallCancellation"],l);const a=i(n,["usageMetadata"]);a!=null&&r(e,["usageMetadata"],Ms(a));const u=i(n,["goAway"]);u!=null&&r(e,["goAway"],u);const f=i(n,["sessionResumptionUpdate"]);return f!=null&&r(e,["sessionResumptionUpdate"],f),e}function Is(n){const e={},t=i(n,["functionCall"]);t!=null&&r(e,["functionCall"],t);const o=i(n,["codeExecutionResult"]);o!=null&&r(e,["codeExecutionResult"],o);const s=i(n,["executableCode"]);s!=null&&r(e,["executableCode"],s);const l=i(n,["fileData"]);l!=null&&r(e,["fileData"],ds(l));const a=i(n,["functionResponse"]);a!=null&&r(e,["functionResponse"],a);const u=i(n,["inlineData"]);u!=null&&r(e,["inlineData"],le(u));const f=i(n,["text"]);f!=null&&r(e,["text"],f);const d=i(n,["thought"]);d!=null&&r(e,["thought"],d);const c=i(n,["thoughtSignature"]);c!=null&&r(e,["thoughtSignature"],c);const p=i(n,["videoMetadata"]);return p!=null&&r(e,["videoMetadata"],p),e}function As(n){const e={},t=i(n,["handle"]);if(t!=null&&r(e,["handle"],t),i(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function Mt(n){const e={},t=i(n,["languageCode"]);t!=null&&r(e,["languageCode"],t);const o=i(n,["voiceConfig"]);if(o!=null&&r(e,["voiceConfig"],o),i(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function Rs(n){const e={},t=i(n,["functionDeclarations"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(p=>p)),r(e,["functionDeclarations"],c)}if(i(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=i(n,["googleSearchRetrieval"]);o!=null&&r(e,["googleSearchRetrieval"],o);const s=i(n,["computerUse"]);s!=null&&r(e,["computerUse"],s);const l=i(n,["fileSearch"]);l!=null&&r(e,["fileSearch"],l);const a=i(n,["codeExecution"]);if(a!=null&&r(e,["codeExecution"],a),i(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=i(n,["googleMaps"]);u!=null&&r(e,["googleMaps"],ps(u));const f=i(n,["googleSearch"]);f!=null&&r(e,["googleSearch"],ms(f));const d=i(n,["urlContext"]);return d!=null&&r(e,["urlContext"],d),e}function Ps(n){const e={},t=i(n,["functionDeclarations"]);if(t!=null){let p=t;Array.isArray(p)&&(p=p.map(m=>fs(m))),r(e,["functionDeclarations"],p)}const o=i(n,["retrieval"]);o!=null&&r(e,["retrieval"],o);const s=i(n,["googleSearchRetrieval"]);s!=null&&r(e,["googleSearchRetrieval"],s);const l=i(n,["computerUse"]);if(l!=null&&r(e,["computerUse"],l),i(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=i(n,["codeExecution"]);a!=null&&r(e,["codeExecution"],a);const u=i(n,["enterpriseWebSearch"]);u!=null&&r(e,["enterpriseWebSearch"],u);const f=i(n,["googleMaps"]);f!=null&&r(e,["googleMaps"],f);const d=i(n,["googleSearch"]);d!=null&&r(e,["googleSearch"],d);const c=i(n,["urlContext"]);return c!=null&&r(e,["urlContext"],c),e}function Ms(n){const e={},t=i(n,["promptTokenCount"]);t!=null&&r(e,["promptTokenCount"],t);const o=i(n,["cachedContentTokenCount"]);o!=null&&r(e,["cachedContentTokenCount"],o);const s=i(n,["candidatesTokenCount"]);s!=null&&r(e,["responseTokenCount"],s);const l=i(n,["toolUsePromptTokenCount"]);l!=null&&r(e,["toolUsePromptTokenCount"],l);const a=i(n,["thoughtsTokenCount"]);a!=null&&r(e,["thoughtsTokenCount"],a);const u=i(n,["totalTokenCount"]);u!=null&&r(e,["totalTokenCount"],u);const f=i(n,["promptTokensDetails"]);if(f!=null){let h=f;Array.isArray(h)&&(h=h.map(g=>g)),r(e,["promptTokensDetails"],h)}const d=i(n,["cacheTokensDetails"]);if(d!=null){let h=d;Array.isArray(h)&&(h=h.map(g=>g)),r(e,["cacheTokensDetails"],h)}const c=i(n,["candidatesTokensDetails"]);if(c!=null){let h=c;Array.isArray(h)&&(h=h.map(g=>g)),r(e,["responseTokensDetails"],h)}const p=i(n,["toolUsePromptTokensDetails"]);if(p!=null){let h=p;Array.isArray(h)&&(h=h.map(g=>g)),r(e,["toolUsePromptTokensDetails"],h)}const m=i(n,["trafficType"]);return m!=null&&r(e,["trafficType"],m),e}function Ns(n){const e={},t=i(n,["data"]);if(t!=null&&r(e,["data"],t),i(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=i(n,["mimeType"]);return o!=null&&r(e,["mimeType"],o),e}function ws(n){const e={},t=i(n,["content"]);t!=null&&r(e,["content"],t);const o=i(n,["citationMetadata"]);o!=null&&r(e,["citationMetadata"],Ds(o));const s=i(n,["tokenCount"]);s!=null&&r(e,["tokenCount"],s);const l=i(n,["finishReason"]);l!=null&&r(e,["finishReason"],l);const a=i(n,["avgLogprobs"]);a!=null&&r(e,["avgLogprobs"],a);const u=i(n,["groundingMetadata"]);u!=null&&r(e,["groundingMetadata"],u);const f=i(n,["index"]);f!=null&&r(e,["index"],f);const d=i(n,["logprobsResult"]);d!=null&&r(e,["logprobsResult"],d);const c=i(n,["safetyRatings"]);if(c!=null){let m=c;Array.isArray(m)&&(m=m.map(h=>h)),r(e,["safetyRatings"],m)}const p=i(n,["urlContextMetadata"]);return p!=null&&r(e,["urlContextMetadata"],p),e}function Ds(n){const e={},t=i(n,["citationSources"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>s)),r(e,["citations"],o)}return e}function xs(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["contents"]);if(s!=null){let l=B(s);Array.isArray(l)&&(l=l.map(a=>a)),r(t,["contents"],l)}return t}function Us(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["tokensInfo"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>l)),r(e,["tokensInfo"],s)}return e}function Ls(n){const e={},t=i(n,["values"]);t!=null&&r(e,["values"],t);const o=i(n,["statistics"]);return o!=null&&r(e,["statistics"],ks(o)),e}function ks(n){const e={},t=i(n,["truncated"]);t!=null&&r(e,["truncated"],t);const o=i(n,["token_count"]);return o!=null&&r(e,["tokenCount"],o),e}function me(n){const e={},t=i(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(l=>Hr(l))),r(e,["parts"],s)}const o=i(n,["role"]);return o!=null&&r(e,["role"],o),e}function Fs(n){const e={},t=i(n,["controlType"]);t!=null&&r(e,["controlType"],t);const o=i(n,["enableControlImageComputation"]);return o!=null&&r(e,["computeControl"],o),e}function Vs(n){const e={};if(i(n,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(i(n,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(i(n,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return e}function Gs(n,e){const t={},o=i(n,["systemInstruction"]);e!==void 0&&o!=null&&r(e,["systemInstruction"],V(o));const s=i(n,["tools"]);if(e!==void 0&&s!=null){let a=s;Array.isArray(a)&&(a=a.map(u=>Ut(u))),r(e,["tools"],a)}const l=i(n,["generationConfig"]);return e!==void 0&&l!=null&&r(e,["generationConfig"],Pr(l)),t}function qs(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["contents"]);if(s!=null){let a=B(s);Array.isArray(a)&&(a=a.map(u=>me(u))),r(t,["contents"],a)}const l=i(e,["config"]);return l!=null&&Vs(l),t}function Hs(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["contents"]);if(s!=null){let a=B(s);Array.isArray(a)&&(a=a.map(u=>u)),r(t,["contents"],a)}const l=i(e,["config"]);return l!=null&&Gs(l,t),t}function Bs(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["totalTokens"]);o!=null&&r(e,["totalTokens"],o);const s=i(n,["cachedContentTokenCount"]);return s!=null&&r(e,["cachedContentTokenCount"],s),e}function Js(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["totalTokens"]);return o!=null&&r(e,["totalTokens"],o),e}function $s(n,e){const t={},o=i(e,["model"]);return o!=null&&r(t,["_url","name"],M(n,o)),t}function Ys(n,e){const t={},o=i(e,["model"]);return o!=null&&r(t,["_url","name"],M(n,o)),t}function bs(n){const e={},t=i(n,["sdkHttpResponse"]);return t!=null&&r(e,["sdkHttpResponse"],t),e}function Ws(n){const e={},t=i(n,["sdkHttpResponse"]);return t!=null&&r(e,["sdkHttpResponse"],t),e}function Ks(n,e){const t={},o=i(n,["outputGcsUri"]);e!==void 0&&o!=null&&r(e,["parameters","storageUri"],o);const s=i(n,["negativePrompt"]);e!==void 0&&s!=null&&r(e,["parameters","negativePrompt"],s);const l=i(n,["numberOfImages"]);e!==void 0&&l!=null&&r(e,["parameters","sampleCount"],l);const a=i(n,["aspectRatio"]);e!==void 0&&a!=null&&r(e,["parameters","aspectRatio"],a);const u=i(n,["guidanceScale"]);e!==void 0&&u!=null&&r(e,["parameters","guidanceScale"],u);const f=i(n,["seed"]);e!==void 0&&f!=null&&r(e,["parameters","seed"],f);const d=i(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&r(e,["parameters","safetySetting"],d);const c=i(n,["personGeneration"]);e!==void 0&&c!=null&&r(e,["parameters","personGeneration"],c);const p=i(n,["includeSafetyAttributes"]);e!==void 0&&p!=null&&r(e,["parameters","includeSafetyAttributes"],p);const m=i(n,["includeRaiReason"]);e!==void 0&&m!=null&&r(e,["parameters","includeRaiReason"],m);const h=i(n,["language"]);e!==void 0&&h!=null&&r(e,["parameters","language"],h);const g=i(n,["outputMimeType"]);e!==void 0&&g!=null&&r(e,["parameters","outputOptions","mimeType"],g);const y=i(n,["outputCompressionQuality"]);e!==void 0&&y!=null&&r(e,["parameters","outputOptions","compressionQuality"],y);const _=i(n,["addWatermark"]);e!==void 0&&_!=null&&r(e,["parameters","addWatermark"],_);const C=i(n,["labels"]);e!==void 0&&C!=null&&r(e,["labels"],C);const v=i(n,["editMode"]);e!==void 0&&v!=null&&r(e,["parameters","editMode"],v);const E=i(n,["baseSteps"]);return e!==void 0&&E!=null&&r(e,["parameters","editConfig","baseSteps"],E),t}function zs(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["prompt"]);s!=null&&r(t,["instances[0]","prompt"],s);const l=i(e,["referenceImages"]);if(l!=null){let u=l;Array.isArray(u)&&(u=u.map(f=>Wr(f))),r(t,["instances[0]","referenceImages"],u)}const a=i(e,["config"]);return a!=null&&Ks(a,t),t}function Xs(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["predictions"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>he(l))),r(e,["generatedImages"],s)}return e}function Os(n,e){const t={},o=i(n,["taskType"]);e!==void 0&&o!=null&&r(e,["requests[]","taskType"],o);const s=i(n,["title"]);e!==void 0&&s!=null&&r(e,["requests[]","title"],s);const l=i(n,["outputDimensionality"]);if(e!==void 0&&l!=null&&r(e,["requests[]","outputDimensionality"],l),i(n,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(i(n,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function Qs(n,e){const t={},o=i(n,["taskType"]);e!==void 0&&o!=null&&r(e,["instances[]","task_type"],o);const s=i(n,["title"]);e!==void 0&&s!=null&&r(e,["instances[]","title"],s);const l=i(n,["outputDimensionality"]);e!==void 0&&l!=null&&r(e,["parameters","outputDimensionality"],l);const a=i(n,["mimeType"]);e!==void 0&&a!=null&&r(e,["instances[]","mimeType"],a);const u=i(n,["autoTruncate"]);return e!==void 0&&u!=null&&r(e,["parameters","autoTruncate"],u),t}function Zs(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["contents"]);if(s!=null){let u=Ue(n,s);Array.isArray(u)&&(u=u.map(f=>f)),r(t,["requests[]","content"],u)}const l=i(e,["config"]);l!=null&&Os(l,t);const a=i(e,["model"]);return a!==void 0&&r(t,["requests[]","model"],M(n,a)),t}function js(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["contents"]);if(s!=null){let a=Ue(n,s);Array.isArray(a)&&(a=a.map(u=>u)),r(t,["instances[]","content"],a)}const l=i(e,["config"]);return l!=null&&Qs(l,t),t}function er(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["embeddings"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(a=>a)),r(e,["embeddings"],l)}const s=i(n,["metadata"]);return s!=null&&r(e,["metadata"],s),e}function nr(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["predictions[]","embeddings"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(a=>Ls(a))),r(e,["embeddings"],l)}const s=i(n,["metadata"]);return s!=null&&r(e,["metadata"],s),e}function tr(n){const e={},t=i(n,["endpoint"]);t!=null&&r(e,["name"],t);const o=i(n,["deployedModelId"]);return o!=null&&r(e,["deployedModelId"],o),e}function or(n){const e={};if(i(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=i(n,["fileUri"]);t!=null&&r(e,["fileUri"],t);const o=i(n,["mimeType"]);return o!=null&&r(e,["mimeType"],o),e}function ir(n){const e={};if(i(n,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");const t=i(n,["description"]);t!=null&&r(e,["description"],t);const o=i(n,["name"]);o!=null&&r(e,["name"],o);const s=i(n,["parameters"]);s!=null&&r(e,["parameters"],s);const l=i(n,["parametersJsonSchema"]);l!=null&&r(e,["parametersJsonSchema"],l);const a=i(n,["response"]);a!=null&&r(e,["response"],a);const u=i(n,["responseJsonSchema"]);return u!=null&&r(e,["responseJsonSchema"],u),e}function sr(n,e,t){const o={},s=i(e,["systemInstruction"]);t!==void 0&&s!=null&&r(t,["systemInstruction"],me(V(s)));const l=i(e,["temperature"]);l!=null&&r(o,["temperature"],l);const a=i(e,["topP"]);a!=null&&r(o,["topP"],a);const u=i(e,["topK"]);u!=null&&r(o,["topK"],u);const f=i(e,["candidateCount"]);f!=null&&r(o,["candidateCount"],f);const d=i(e,["maxOutputTokens"]);d!=null&&r(o,["maxOutputTokens"],d);const c=i(e,["stopSequences"]);c!=null&&r(o,["stopSequences"],c);const p=i(e,["responseLogprobs"]);p!=null&&r(o,["responseLogprobs"],p);const m=i(e,["logprobs"]);m!=null&&r(o,["logprobs"],m);const h=i(e,["presencePenalty"]);h!=null&&r(o,["presencePenalty"],h);const g=i(e,["frequencyPenalty"]);g!=null&&r(o,["frequencyPenalty"],g);const y=i(e,["seed"]);y!=null&&r(o,["seed"],y);const _=i(e,["responseMimeType"]);_!=null&&r(o,["responseMimeType"],_);const C=i(e,["responseSchema"]);C!=null&&r(o,["responseSchema"],Le(C));const v=i(e,["responseJsonSchema"]);if(v!=null&&r(o,["responseJsonSchema"],v),i(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(i(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const E=i(e,["safetySettings"]);if(t!==void 0&&E!=null){let D=E;Array.isArray(D)&&(D=D.map(Y=>Kr(Y))),r(t,["safetySettings"],D)}const S=i(e,["tools"]);if(t!==void 0&&S!=null){let D=te(S);Array.isArray(D)&&(D=D.map(Y=>jr(ne(Y)))),r(t,["tools"],D)}const A=i(e,["toolConfig"]);if(t!==void 0&&A!=null&&r(t,["toolConfig"],A),i(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const R=i(e,["cachedContent"]);t!==void 0&&R!=null&&r(t,["cachedContent"],z(n,R));const P=i(e,["responseModalities"]);P!=null&&r(o,["responseModalities"],P);const F=i(e,["mediaResolution"]);F!=null&&r(o,["mediaResolution"],F);const I=i(e,["speechConfig"]);if(I!=null&&r(o,["speechConfig"],ke(I)),i(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const N=i(e,["thinkingConfig"]);N!=null&&r(o,["thinkingConfig"],N);const L=i(e,["imageConfig"]);return L!=null&&r(o,["imageConfig"],L),o}function rr(n,e,t){const o={},s=i(e,["systemInstruction"]);t!==void 0&&s!=null&&r(t,["systemInstruction"],V(s));const l=i(e,["temperature"]);l!=null&&r(o,["temperature"],l);const a=i(e,["topP"]);a!=null&&r(o,["topP"],a);const u=i(e,["topK"]);u!=null&&r(o,["topK"],u);const f=i(e,["candidateCount"]);f!=null&&r(o,["candidateCount"],f);const d=i(e,["maxOutputTokens"]);d!=null&&r(o,["maxOutputTokens"],d);const c=i(e,["stopSequences"]);c!=null&&r(o,["stopSequences"],c);const p=i(e,["responseLogprobs"]);p!=null&&r(o,["responseLogprobs"],p);const m=i(e,["logprobs"]);m!=null&&r(o,["logprobs"],m);const h=i(e,["presencePenalty"]);h!=null&&r(o,["presencePenalty"],h);const g=i(e,["frequencyPenalty"]);g!=null&&r(o,["frequencyPenalty"],g);const y=i(e,["seed"]);y!=null&&r(o,["seed"],y);const _=i(e,["responseMimeType"]);_!=null&&r(o,["responseMimeType"],_);const C=i(e,["responseSchema"]);C!=null&&r(o,["responseSchema"],Le(C));const v=i(e,["responseJsonSchema"]);v!=null&&r(o,["responseJsonSchema"],v);const E=i(e,["routingConfig"]);E!=null&&r(o,["routingConfig"],E);const S=i(e,["modelSelectionConfig"]);S!=null&&r(o,["modelConfig"],S);const A=i(e,["safetySettings"]);if(t!==void 0&&A!=null){let b=A;Array.isArray(b)&&(b=b.map(ye=>ye)),r(t,["safetySettings"],b)}const R=i(e,["tools"]);if(t!==void 0&&R!=null){let b=te(R);Array.isArray(b)&&(b=b.map(ye=>Ut(ne(ye)))),r(t,["tools"],b)}const P=i(e,["toolConfig"]);t!==void 0&&P!=null&&r(t,["toolConfig"],P);const F=i(e,["labels"]);t!==void 0&&F!=null&&r(t,["labels"],F);const I=i(e,["cachedContent"]);t!==void 0&&I!=null&&r(t,["cachedContent"],z(n,I));const N=i(e,["responseModalities"]);N!=null&&r(o,["responseModalities"],N);const L=i(e,["mediaResolution"]);L!=null&&r(o,["mediaResolution"],L);const D=i(e,["speechConfig"]);D!=null&&r(o,["speechConfig"],xt(ke(D)));const Y=i(e,["audioTimestamp"]);Y!=null&&r(o,["audioTimestamp"],Y);const Be=i(e,["thinkingConfig"]);Be!=null&&r(o,["thinkingConfig"],Be);const Je=i(e,["imageConfig"]);return Je!=null&&r(o,["imageConfig"],Je),o}function nt(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["contents"]);if(s!=null){let a=B(s);Array.isArray(a)&&(a=a.map(u=>me(u))),r(t,["contents"],a)}const l=i(e,["config"]);return l!=null&&r(t,["generationConfig"],sr(n,l,t)),t}function tt(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["contents"]);if(s!=null){let a=B(s);Array.isArray(a)&&(a=a.map(u=>u)),r(t,["contents"],a)}const l=i(e,["config"]);return l!=null&&r(t,["generationConfig"],rr(n,l,t)),t}function ot(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["candidates"]);if(o!=null){let f=o;Array.isArray(f)&&(f=f.map(d=>ws(d))),r(e,["candidates"],f)}const s=i(n,["modelVersion"]);s!=null&&r(e,["modelVersion"],s);const l=i(n,["promptFeedback"]);l!=null&&r(e,["promptFeedback"],l);const a=i(n,["responseId"]);a!=null&&r(e,["responseId"],a);const u=i(n,["usageMetadata"]);return u!=null&&r(e,["usageMetadata"],u),e}function it(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["candidates"]);if(o!=null){let d=o;Array.isArray(d)&&(d=d.map(c=>c)),r(e,["candidates"],d)}const s=i(n,["createTime"]);s!=null&&r(e,["createTime"],s);const l=i(n,["modelVersion"]);l!=null&&r(e,["modelVersion"],l);const a=i(n,["promptFeedback"]);a!=null&&r(e,["promptFeedback"],a);const u=i(n,["responseId"]);u!=null&&r(e,["responseId"],u);const f=i(n,["usageMetadata"]);return f!=null&&r(e,["usageMetadata"],f),e}function lr(n,e){const t={};if(i(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(i(n,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const o=i(n,["numberOfImages"]);e!==void 0&&o!=null&&r(e,["parameters","sampleCount"],o);const s=i(n,["aspectRatio"]);e!==void 0&&s!=null&&r(e,["parameters","aspectRatio"],s);const l=i(n,["guidanceScale"]);if(e!==void 0&&l!=null&&r(e,["parameters","guidanceScale"],l),i(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const a=i(n,["safetyFilterLevel"]);e!==void 0&&a!=null&&r(e,["parameters","safetySetting"],a);const u=i(n,["personGeneration"]);e!==void 0&&u!=null&&r(e,["parameters","personGeneration"],u);const f=i(n,["includeSafetyAttributes"]);e!==void 0&&f!=null&&r(e,["parameters","includeSafetyAttributes"],f);const d=i(n,["includeRaiReason"]);e!==void 0&&d!=null&&r(e,["parameters","includeRaiReason"],d);const c=i(n,["language"]);e!==void 0&&c!=null&&r(e,["parameters","language"],c);const p=i(n,["outputMimeType"]);e!==void 0&&p!=null&&r(e,["parameters","outputOptions","mimeType"],p);const m=i(n,["outputCompressionQuality"]);if(e!==void 0&&m!=null&&r(e,["parameters","outputOptions","compressionQuality"],m),i(n,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(i(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const h=i(n,["imageSize"]);if(e!==void 0&&h!=null&&r(e,["parameters","sampleImageSize"],h),i(n,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return t}function ar(n,e){const t={},o=i(n,["outputGcsUri"]);e!==void 0&&o!=null&&r(e,["parameters","storageUri"],o);const s=i(n,["negativePrompt"]);e!==void 0&&s!=null&&r(e,["parameters","negativePrompt"],s);const l=i(n,["numberOfImages"]);e!==void 0&&l!=null&&r(e,["parameters","sampleCount"],l);const a=i(n,["aspectRatio"]);e!==void 0&&a!=null&&r(e,["parameters","aspectRatio"],a);const u=i(n,["guidanceScale"]);e!==void 0&&u!=null&&r(e,["parameters","guidanceScale"],u);const f=i(n,["seed"]);e!==void 0&&f!=null&&r(e,["parameters","seed"],f);const d=i(n,["safetyFilterLevel"]);e!==void 0&&d!=null&&r(e,["parameters","safetySetting"],d);const c=i(n,["personGeneration"]);e!==void 0&&c!=null&&r(e,["parameters","personGeneration"],c);const p=i(n,["includeSafetyAttributes"]);e!==void 0&&p!=null&&r(e,["parameters","includeSafetyAttributes"],p);const m=i(n,["includeRaiReason"]);e!==void 0&&m!=null&&r(e,["parameters","includeRaiReason"],m);const h=i(n,["language"]);e!==void 0&&h!=null&&r(e,["parameters","language"],h);const g=i(n,["outputMimeType"]);e!==void 0&&g!=null&&r(e,["parameters","outputOptions","mimeType"],g);const y=i(n,["outputCompressionQuality"]);e!==void 0&&y!=null&&r(e,["parameters","outputOptions","compressionQuality"],y);const _=i(n,["addWatermark"]);e!==void 0&&_!=null&&r(e,["parameters","addWatermark"],_);const C=i(n,["labels"]);e!==void 0&&C!=null&&r(e,["labels"],C);const v=i(n,["imageSize"]);e!==void 0&&v!=null&&r(e,["parameters","sampleImageSize"],v);const E=i(n,["enhancePrompt"]);return e!==void 0&&E!=null&&r(e,["parameters","enhancePrompt"],E),t}function ur(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["prompt"]);s!=null&&r(t,["instances[0]","prompt"],s);const l=i(e,["config"]);return l!=null&&lr(l,t),t}function dr(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["prompt"]);s!=null&&r(t,["instances[0]","prompt"],s);const l=i(e,["config"]);return l!=null&&ar(l,t),t}function fr(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["predictions"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(a=>Sr(a))),r(e,["generatedImages"],l)}const s=i(n,["positivePromptSafetyAttributes"]);return s!=null&&r(e,["positivePromptSafetyAttributes"],wt(s)),e}function cr(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["predictions"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(a=>he(a))),r(e,["generatedImages"],l)}const s=i(n,["positivePromptSafetyAttributes"]);return s!=null&&r(e,["positivePromptSafetyAttributes"],Dt(s)),e}function pr(n,e){const t={},o=i(n,["numberOfVideos"]);if(e!==void 0&&o!=null&&r(e,["parameters","sampleCount"],o),i(n,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(i(n,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const s=i(n,["durationSeconds"]);if(e!==void 0&&s!=null&&r(e,["parameters","durationSeconds"],s),i(n,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=i(n,["aspectRatio"]);e!==void 0&&l!=null&&r(e,["parameters","aspectRatio"],l);const a=i(n,["resolution"]);e!==void 0&&a!=null&&r(e,["parameters","resolution"],a);const u=i(n,["personGeneration"]);if(e!==void 0&&u!=null&&r(e,["parameters","personGeneration"],u),i(n,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const f=i(n,["negativePrompt"]);e!==void 0&&f!=null&&r(e,["parameters","negativePrompt"],f);const d=i(n,["enhancePrompt"]);if(e!==void 0&&d!=null&&r(e,["parameters","enhancePrompt"],d),i(n,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const c=i(n,["lastFrame"]);e!==void 0&&c!=null&&r(e,["instances[0]","lastFrame"],ge(c));const p=i(n,["referenceImages"]);if(e!==void 0&&p!=null){let m=p;Array.isArray(m)&&(m=m.map(h=>cl(h))),r(e,["instances[0]","referenceImages"],m)}if(i(n,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(i(n,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return t}function mr(n,e){const t={},o=i(n,["numberOfVideos"]);e!==void 0&&o!=null&&r(e,["parameters","sampleCount"],o);const s=i(n,["outputGcsUri"]);e!==void 0&&s!=null&&r(e,["parameters","storageUri"],s);const l=i(n,["fps"]);e!==void 0&&l!=null&&r(e,["parameters","fps"],l);const a=i(n,["durationSeconds"]);e!==void 0&&a!=null&&r(e,["parameters","durationSeconds"],a);const u=i(n,["seed"]);e!==void 0&&u!=null&&r(e,["parameters","seed"],u);const f=i(n,["aspectRatio"]);e!==void 0&&f!=null&&r(e,["parameters","aspectRatio"],f);const d=i(n,["resolution"]);e!==void 0&&d!=null&&r(e,["parameters","resolution"],d);const c=i(n,["personGeneration"]);e!==void 0&&c!=null&&r(e,["parameters","personGeneration"],c);const p=i(n,["pubsubTopic"]);e!==void 0&&p!=null&&r(e,["parameters","pubsubTopic"],p);const m=i(n,["negativePrompt"]);e!==void 0&&m!=null&&r(e,["parameters","negativePrompt"],m);const h=i(n,["enhancePrompt"]);e!==void 0&&h!=null&&r(e,["parameters","enhancePrompt"],h);const g=i(n,["generateAudio"]);e!==void 0&&g!=null&&r(e,["parameters","generateAudio"],g);const y=i(n,["lastFrame"]);e!==void 0&&y!=null&&r(e,["instances[0]","lastFrame"],J(y));const _=i(n,["referenceImages"]);if(e!==void 0&&_!=null){let E=_;Array.isArray(E)&&(E=E.map(S=>pl(S))),r(e,["instances[0]","referenceImages"],E)}const C=i(n,["mask"]);e!==void 0&&C!=null&&r(e,["instances[0]","mask"],fl(C));const v=i(n,["compressionQuality"]);return e!==void 0&&v!=null&&r(e,["parameters","compressionQuality"],v),t}function hr(n){const e={},t=i(n,["name"]);t!=null&&r(e,["name"],t);const o=i(n,["metadata"]);o!=null&&r(e,["metadata"],o);const s=i(n,["done"]);s!=null&&r(e,["done"],s);const l=i(n,["error"]);l!=null&&r(e,["error"],l);const a=i(n,["response","generateVideoResponse"]);return a!=null&&r(e,["response"],Er(a)),e}function gr(n){const e={},t=i(n,["name"]);t!=null&&r(e,["name"],t);const o=i(n,["metadata"]);o!=null&&r(e,["metadata"],o);const s=i(n,["done"]);s!=null&&r(e,["done"],s);const l=i(n,["error"]);l!=null&&r(e,["error"],l);const a=i(n,["response"]);return a!=null&&r(e,["response"],_r(a)),e}function yr(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["prompt"]);s!=null&&r(t,["instances[0]","prompt"],s);const l=i(e,["image"]);l!=null&&r(t,["instances[0]","image"],ge(l));const a=i(e,["video"]);a!=null&&r(t,["instances[0]","video"],Lt(a));const u=i(e,["source"]);u!=null&&Cr(u,t);const f=i(e,["config"]);return f!=null&&pr(f,t),t}function Tr(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["prompt"]);s!=null&&r(t,["instances[0]","prompt"],s);const l=i(e,["image"]);l!=null&&r(t,["instances[0]","image"],J(l));const a=i(e,["video"]);a!=null&&r(t,["instances[0]","video"],kt(a));const u=i(e,["source"]);u!=null&&vr(u,t);const f=i(e,["config"]);return f!=null&&mr(f,t),t}function Er(n){const e={},t=i(n,["generatedSamples"]);if(t!=null){let l=t;Array.isArray(l)&&(l=l.map(a=>Ar(a))),r(e,["generatedVideos"],l)}const o=i(n,["raiMediaFilteredCount"]);o!=null&&r(e,["raiMediaFilteredCount"],o);const s=i(n,["raiMediaFilteredReasons"]);return s!=null&&r(e,["raiMediaFilteredReasons"],s),e}function _r(n){const e={},t=i(n,["videos"]);if(t!=null){let l=t;Array.isArray(l)&&(l=l.map(a=>Rr(a))),r(e,["generatedVideos"],l)}const o=i(n,["raiMediaFilteredCount"]);o!=null&&r(e,["raiMediaFilteredCount"],o);const s=i(n,["raiMediaFilteredReasons"]);return s!=null&&r(e,["raiMediaFilteredReasons"],s),e}function Cr(n,e){const t={},o=i(n,["prompt"]);e!==void 0&&o!=null&&r(e,["instances[0]","prompt"],o);const s=i(n,["image"]);e!==void 0&&s!=null&&r(e,["instances[0]","image"],ge(s));const l=i(n,["video"]);return e!==void 0&&l!=null&&r(e,["instances[0]","video"],Lt(l)),t}function vr(n,e){const t={},o=i(n,["prompt"]);e!==void 0&&o!=null&&r(e,["instances[0]","prompt"],o);const s=i(n,["image"]);e!==void 0&&s!=null&&r(e,["instances[0]","image"],J(s));const l=i(n,["video"]);return e!==void 0&&l!=null&&r(e,["instances[0]","video"],kt(l)),t}function Sr(n){const e={},t=i(n,["_self"]);t!=null&&r(e,["image"],xr(t));const o=i(n,["raiFilteredReason"]);o!=null&&r(e,["raiFilteredReason"],o);const s=i(n,["_self"]);return s!=null&&r(e,["safetyAttributes"],wt(s)),e}function he(n){const e={},t=i(n,["_self"]);t!=null&&r(e,["image"],Nt(t));const o=i(n,["raiFilteredReason"]);o!=null&&r(e,["raiFilteredReason"],o);const s=i(n,["_self"]);s!=null&&r(e,["safetyAttributes"],Dt(s));const l=i(n,["prompt"]);return l!=null&&r(e,["enhancedPrompt"],l),e}function Ir(n){const e={},t=i(n,["_self"]);t!=null&&r(e,["mask"],Nt(t));const o=i(n,["labels"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>l)),r(e,["labels"],s)}return e}function Ar(n){const e={},t=i(n,["video"]);return t!=null&&r(e,["video"],ul(t)),e}function Rr(n){const e={},t=i(n,["_self"]);return t!=null&&r(e,["video"],dl(t)),e}function Pr(n){const e={},t=i(n,["modelSelectionConfig"]);t!=null&&r(e,["modelConfig"],t);const o=i(n,["responseJsonSchema"]);o!=null&&r(e,["responseJsonSchema"],o);const s=i(n,["audioTimestamp"]);s!=null&&r(e,["audioTimestamp"],s);const l=i(n,["candidateCount"]);l!=null&&r(e,["candidateCount"],l);const a=i(n,["enableAffectiveDialog"]);a!=null&&r(e,["enableAffectiveDialog"],a);const u=i(n,["frequencyPenalty"]);u!=null&&r(e,["frequencyPenalty"],u);const f=i(n,["logprobs"]);f!=null&&r(e,["logprobs"],f);const d=i(n,["maxOutputTokens"]);d!=null&&r(e,["maxOutputTokens"],d);const c=i(n,["mediaResolution"]);c!=null&&r(e,["mediaResolution"],c);const p=i(n,["presencePenalty"]);p!=null&&r(e,["presencePenalty"],p);const m=i(n,["responseLogprobs"]);m!=null&&r(e,["responseLogprobs"],m);const h=i(n,["responseMimeType"]);h!=null&&r(e,["responseMimeType"],h);const g=i(n,["responseModalities"]);g!=null&&r(e,["responseModalities"],g);const y=i(n,["responseSchema"]);y!=null&&r(e,["responseSchema"],y);const _=i(n,["routingConfig"]);_!=null&&r(e,["routingConfig"],_);const C=i(n,["seed"]);C!=null&&r(e,["seed"],C);const v=i(n,["speechConfig"]);v!=null&&r(e,["speechConfig"],xt(v));const E=i(n,["stopSequences"]);E!=null&&r(e,["stopSequences"],E);const S=i(n,["temperature"]);S!=null&&r(e,["temperature"],S);const A=i(n,["thinkingConfig"]);A!=null&&r(e,["thinkingConfig"],A);const R=i(n,["topK"]);R!=null&&r(e,["topK"],R);const P=i(n,["topP"]);if(P!=null&&r(e,["topP"],P),i(n,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function Mr(n,e){const t={},o=i(e,["model"]);return o!=null&&r(t,["_url","name"],M(n,o)),t}function Nr(n,e){const t={},o=i(e,["model"]);return o!=null&&r(t,["_url","name"],M(n,o)),t}function wr(n){const e={};if(i(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=i(n,["enableWidget"]);return t!=null&&r(e,["enableWidget"],t),e}function Dr(n){const e={};if(i(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(i(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=i(n,["timeRangeFilter"]);return t!=null&&r(e,["timeRangeFilter"],t),e}function xr(n){const e={},t=i(n,["bytesBase64Encoded"]);t!=null&&r(e,["imageBytes"],X(t));const o=i(n,["mimeType"]);return o!=null&&r(e,["mimeType"],o),e}function Nt(n){const e={},t=i(n,["gcsUri"]);t!=null&&r(e,["gcsUri"],t);const o=i(n,["bytesBase64Encoded"]);o!=null&&r(e,["imageBytes"],X(o));const s=i(n,["mimeType"]);return s!=null&&r(e,["mimeType"],s),e}function ge(n){const e={};if(i(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const t=i(n,["imageBytes"]);t!=null&&r(e,["bytesBase64Encoded"],X(t));const o=i(n,["mimeType"]);return o!=null&&r(e,["mimeType"],o),e}function J(n){const e={},t=i(n,["gcsUri"]);t!=null&&r(e,["gcsUri"],t);const o=i(n,["imageBytes"]);o!=null&&r(e,["bytesBase64Encoded"],X(o));const s=i(n,["mimeType"]);return s!=null&&r(e,["mimeType"],s),e}function Ur(n,e,t){const o={},s=i(e,["pageSize"]);t!==void 0&&s!=null&&r(t,["_query","pageSize"],s);const l=i(e,["pageToken"]);t!==void 0&&l!=null&&r(t,["_query","pageToken"],l);const a=i(e,["filter"]);t!==void 0&&a!=null&&r(t,["_query","filter"],a);const u=i(e,["queryBase"]);return t!==void 0&&u!=null&&r(t,["_url","models_url"],Ct(n,u)),o}function Lr(n,e,t){const o={},s=i(e,["pageSize"]);t!==void 0&&s!=null&&r(t,["_query","pageSize"],s);const l=i(e,["pageToken"]);t!==void 0&&l!=null&&r(t,["_query","pageToken"],l);const a=i(e,["filter"]);t!==void 0&&a!=null&&r(t,["_query","filter"],a);const u=i(e,["queryBase"]);return t!==void 0&&u!=null&&r(t,["_url","models_url"],Ct(n,u)),o}function kr(n,e){const t={},o=i(e,["config"]);return o!=null&&Ur(n,o,t),t}function Fr(n,e){const t={},o=i(e,["config"]);return o!=null&&Lr(n,o,t),t}function Vr(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["nextPageToken"]);o!=null&&r(e,["nextPageToken"],o);const s=i(n,["_self"]);if(s!=null){let l=vt(s);Array.isArray(l)&&(l=l.map(a=>Ie(a))),r(e,["models"],l)}return e}function Gr(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["nextPageToken"]);o!=null&&r(e,["nextPageToken"],o);const s=i(n,["_self"]);if(s!=null){let l=vt(s);Array.isArray(l)&&(l=l.map(a=>Ae(a))),r(e,["models"],l)}return e}function qr(n){const e={},t=i(n,["maskMode"]);t!=null&&r(e,["maskMode"],t);const o=i(n,["segmentationClasses"]);o!=null&&r(e,["maskClasses"],o);const s=i(n,["maskDilation"]);return s!=null&&r(e,["dilation"],s),e}function Ie(n){const e={},t=i(n,["name"]);t!=null&&r(e,["name"],t);const o=i(n,["displayName"]);o!=null&&r(e,["displayName"],o);const s=i(n,["description"]);s!=null&&r(e,["description"],s);const l=i(n,["version"]);l!=null&&r(e,["version"],l);const a=i(n,["_self"]);a!=null&&r(e,["tunedModelInfo"],el(a));const u=i(n,["inputTokenLimit"]);u!=null&&r(e,["inputTokenLimit"],u);const f=i(n,["outputTokenLimit"]);f!=null&&r(e,["outputTokenLimit"],f);const d=i(n,["supportedGenerationMethods"]);return d!=null&&r(e,["supportedActions"],d),e}function Ae(n){const e={},t=i(n,["name"]);t!=null&&r(e,["name"],t);const o=i(n,["displayName"]);o!=null&&r(e,["displayName"],o);const s=i(n,["description"]);s!=null&&r(e,["description"],s);const l=i(n,["versionId"]);l!=null&&r(e,["version"],l);const a=i(n,["deployedModels"]);if(a!=null){let p=a;Array.isArray(p)&&(p=p.map(m=>tr(m))),r(e,["endpoints"],p)}const u=i(n,["labels"]);u!=null&&r(e,["labels"],u);const f=i(n,["_self"]);f!=null&&r(e,["tunedModelInfo"],nl(f));const d=i(n,["defaultCheckpointId"]);d!=null&&r(e,["defaultCheckpointId"],d);const c=i(n,["checkpoints"]);if(c!=null){let p=c;Array.isArray(p)&&(p=p.map(m=>m)),r(e,["checkpoints"],p)}return e}function Hr(n){const e={},t=i(n,["functionCall"]);t!=null&&r(e,["functionCall"],t);const o=i(n,["codeExecutionResult"]);o!=null&&r(e,["codeExecutionResult"],o);const s=i(n,["executableCode"]);s!=null&&r(e,["executableCode"],s);const l=i(n,["fileData"]);l!=null&&r(e,["fileData"],or(l));const a=i(n,["functionResponse"]);a!=null&&r(e,["functionResponse"],a);const u=i(n,["inlineData"]);u!=null&&r(e,["inlineData"],Ns(u));const f=i(n,["text"]);f!=null&&r(e,["text"],f);const d=i(n,["thought"]);d!=null&&r(e,["thought"],d);const c=i(n,["thoughtSignature"]);c!=null&&r(e,["thoughtSignature"],c);const p=i(n,["videoMetadata"]);return p!=null&&r(e,["videoMetadata"],p),e}function Br(n){const e={},t=i(n,["productImage"]);return t!=null&&r(e,["image"],J(t)),e}function Jr(n,e){const t={},o=i(n,["numberOfImages"]);e!==void 0&&o!=null&&r(e,["parameters","sampleCount"],o);const s=i(n,["baseSteps"]);e!==void 0&&s!=null&&r(e,["parameters","editConfig","baseSteps"],s);const l=i(n,["outputGcsUri"]);e!==void 0&&l!=null&&r(e,["parameters","storageUri"],l);const a=i(n,["seed"]);e!==void 0&&a!=null&&r(e,["parameters","seed"],a);const u=i(n,["safetyFilterLevel"]);e!==void 0&&u!=null&&r(e,["parameters","safetySetting"],u);const f=i(n,["personGeneration"]);e!==void 0&&f!=null&&r(e,["parameters","personGeneration"],f);const d=i(n,["addWatermark"]);e!==void 0&&d!=null&&r(e,["parameters","addWatermark"],d);const c=i(n,["outputMimeType"]);e!==void 0&&c!=null&&r(e,["parameters","outputOptions","mimeType"],c);const p=i(n,["outputCompressionQuality"]);e!==void 0&&p!=null&&r(e,["parameters","outputOptions","compressionQuality"],p);const m=i(n,["enhancePrompt"]);e!==void 0&&m!=null&&r(e,["parameters","enhancePrompt"],m);const h=i(n,["labels"]);return e!==void 0&&h!=null&&r(e,["labels"],h),t}function $r(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["source"]);s!=null&&br(s,t);const l=i(e,["config"]);return l!=null&&Jr(l,t),t}function Yr(n){const e={},t=i(n,["predictions"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>he(s))),r(e,["generatedImages"],o)}return e}function br(n,e){const t={},o=i(n,["prompt"]);e!==void 0&&o!=null&&r(e,["instances[0]","prompt"],o);const s=i(n,["personImage"]);e!==void 0&&s!=null&&r(e,["instances[0]","personImage","image"],J(s));const l=i(n,["productImages"]);if(e!==void 0&&l!=null){let a=l;Array.isArray(a)&&(a=a.map(u=>Br(u))),r(e,["instances[0]","productImages"],a)}return t}function Wr(n){const e={},t=i(n,["referenceImage"]);t!=null&&r(e,["referenceImage"],J(t));const o=i(n,["referenceId"]);o!=null&&r(e,["referenceId"],o);const s=i(n,["referenceType"]);s!=null&&r(e,["referenceType"],s);const l=i(n,["maskImageConfig"]);l!=null&&r(e,["maskImageConfig"],qr(l));const a=i(n,["controlImageConfig"]);a!=null&&r(e,["controlImageConfig"],Fs(a));const u=i(n,["styleImageConfig"]);u!=null&&r(e,["styleImageConfig"],u);const f=i(n,["subjectImageConfig"]);return f!=null&&r(e,["subjectImageConfig"],f),e}function wt(n){const e={},t=i(n,["safetyAttributes","categories"]);t!=null&&r(e,["categories"],t);const o=i(n,["safetyAttributes","scores"]);o!=null&&r(e,["scores"],o);const s=i(n,["contentType"]);return s!=null&&r(e,["contentType"],s),e}function Dt(n){const e={},t=i(n,["safetyAttributes","categories"]);t!=null&&r(e,["categories"],t);const o=i(n,["safetyAttributes","scores"]);o!=null&&r(e,["scores"],o);const s=i(n,["contentType"]);return s!=null&&r(e,["contentType"],s),e}function Kr(n){const e={},t=i(n,["category"]);if(t!=null&&r(e,["category"],t),i(n,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const o=i(n,["threshold"]);return o!=null&&r(e,["threshold"],o),e}function zr(n){const e={},t=i(n,["image"]);return t!=null&&r(e,["image"],J(t)),e}function Xr(n,e){const t={},o=i(n,["mode"]);e!==void 0&&o!=null&&r(e,["parameters","mode"],o);const s=i(n,["maxPredictions"]);e!==void 0&&s!=null&&r(e,["parameters","maxPredictions"],s);const l=i(n,["confidenceThreshold"]);e!==void 0&&l!=null&&r(e,["parameters","confidenceThreshold"],l);const a=i(n,["maskDilation"]);e!==void 0&&a!=null&&r(e,["parameters","maskDilation"],a);const u=i(n,["binaryColorThreshold"]);e!==void 0&&u!=null&&r(e,["parameters","binaryColorThreshold"],u);const f=i(n,["labels"]);return e!==void 0&&f!=null&&r(e,["labels"],f),t}function Or(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["source"]);s!=null&&Zr(s,t);const l=i(e,["config"]);return l!=null&&Xr(l,t),t}function Qr(n){const e={},t=i(n,["predictions"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(s=>Ir(s))),r(e,["generatedMasks"],o)}return e}function Zr(n,e){const t={},o=i(n,["prompt"]);e!==void 0&&o!=null&&r(e,["instances[0]","prompt"],o);const s=i(n,["image"]);e!==void 0&&s!=null&&r(e,["instances[0]","image"],J(s));const l=i(n,["scribbleImage"]);return e!==void 0&&l!=null&&r(e,["instances[0]","scribble"],zr(l)),t}function xt(n){const e={},t=i(n,["languageCode"]);t!=null&&r(e,["languageCode"],t);const o=i(n,["voiceConfig"]);if(o!=null&&r(e,["voiceConfig"],o),i(n,["multiSpeakerVoiceConfig"])!==void 0)throw new Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return e}function jr(n){const e={},t=i(n,["functionDeclarations"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(p=>p)),r(e,["functionDeclarations"],c)}if(i(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=i(n,["googleSearchRetrieval"]);o!=null&&r(e,["googleSearchRetrieval"],o);const s=i(n,["computerUse"]);s!=null&&r(e,["computerUse"],s);const l=i(n,["fileSearch"]);l!=null&&r(e,["fileSearch"],l);const a=i(n,["codeExecution"]);if(a!=null&&r(e,["codeExecution"],a),i(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=i(n,["googleMaps"]);u!=null&&r(e,["googleMaps"],wr(u));const f=i(n,["googleSearch"]);f!=null&&r(e,["googleSearch"],Dr(f));const d=i(n,["urlContext"]);return d!=null&&r(e,["urlContext"],d),e}function Ut(n){const e={},t=i(n,["functionDeclarations"]);if(t!=null){let p=t;Array.isArray(p)&&(p=p.map(m=>ir(m))),r(e,["functionDeclarations"],p)}const o=i(n,["retrieval"]);o!=null&&r(e,["retrieval"],o);const s=i(n,["googleSearchRetrieval"]);s!=null&&r(e,["googleSearchRetrieval"],s);const l=i(n,["computerUse"]);if(l!=null&&r(e,["computerUse"],l),i(n,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const a=i(n,["codeExecution"]);a!=null&&r(e,["codeExecution"],a);const u=i(n,["enterpriseWebSearch"]);u!=null&&r(e,["enterpriseWebSearch"],u);const f=i(n,["googleMaps"]);f!=null&&r(e,["googleMaps"],f);const d=i(n,["googleSearch"]);d!=null&&r(e,["googleSearch"],d);const c=i(n,["urlContext"]);return c!=null&&r(e,["urlContext"],c),e}function el(n){const e={},t=i(n,["baseModel"]);t!=null&&r(e,["baseModel"],t);const o=i(n,["createTime"]);o!=null&&r(e,["createTime"],o);const s=i(n,["updateTime"]);return s!=null&&r(e,["updateTime"],s),e}function nl(n){const e={},t=i(n,["labels","google-vertex-llm-tuning-base-model-id"]);t!=null&&r(e,["baseModel"],t);const o=i(n,["createTime"]);o!=null&&r(e,["createTime"],o);const s=i(n,["updateTime"]);return s!=null&&r(e,["updateTime"],s),e}function tl(n,e){const t={},o=i(n,["displayName"]);e!==void 0&&o!=null&&r(e,["displayName"],o);const s=i(n,["description"]);e!==void 0&&s!=null&&r(e,["description"],s);const l=i(n,["defaultCheckpointId"]);return e!==void 0&&l!=null&&r(e,["defaultCheckpointId"],l),t}function ol(n,e){const t={},o=i(n,["displayName"]);e!==void 0&&o!=null&&r(e,["displayName"],o);const s=i(n,["description"]);e!==void 0&&s!=null&&r(e,["description"],s);const l=i(n,["defaultCheckpointId"]);return e!==void 0&&l!=null&&r(e,["defaultCheckpointId"],l),t}function il(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","name"],M(n,o));const s=i(e,["config"]);return s!=null&&tl(s,t),t}function sl(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["config"]);return s!=null&&ol(s,t),t}function rl(n,e){const t={},o=i(n,["outputGcsUri"]);e!==void 0&&o!=null&&r(e,["parameters","storageUri"],o);const s=i(n,["safetyFilterLevel"]);e!==void 0&&s!=null&&r(e,["parameters","safetySetting"],s);const l=i(n,["personGeneration"]);e!==void 0&&l!=null&&r(e,["parameters","personGeneration"],l);const a=i(n,["includeRaiReason"]);e!==void 0&&a!=null&&r(e,["parameters","includeRaiReason"],a);const u=i(n,["outputMimeType"]);e!==void 0&&u!=null&&r(e,["parameters","outputOptions","mimeType"],u);const f=i(n,["outputCompressionQuality"]);e!==void 0&&f!=null&&r(e,["parameters","outputOptions","compressionQuality"],f);const d=i(n,["enhanceInputImage"]);e!==void 0&&d!=null&&r(e,["parameters","upscaleConfig","enhanceInputImage"],d);const c=i(n,["imagePreservationFactor"]);e!==void 0&&c!=null&&r(e,["parameters","upscaleConfig","imagePreservationFactor"],c);const p=i(n,["labels"]);e!==void 0&&p!=null&&r(e,["labels"],p);const m=i(n,["numberOfImages"]);e!==void 0&&m!=null&&r(e,["parameters","sampleCount"],m);const h=i(n,["mode"]);return e!==void 0&&h!=null&&r(e,["parameters","mode"],h),t}function ll(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["_url","model"],M(n,o));const s=i(e,["image"]);s!=null&&r(t,["instances[0]","image"],J(s));const l=i(e,["upscaleFactor"]);l!=null&&r(t,["parameters","upscaleConfig","upscaleFactor"],l);const a=i(e,["config"]);return a!=null&&rl(a,t),t}function al(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["predictions"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>he(l))),r(e,["generatedImages"],s)}return e}function ul(n){const e={},t=i(n,["uri"]);t!=null&&r(e,["uri"],t);const o=i(n,["encodedVideo"]);o!=null&&r(e,["videoBytes"],X(o));const s=i(n,["encoding"]);return s!=null&&r(e,["mimeType"],s),e}function dl(n){const e={},t=i(n,["gcsUri"]);t!=null&&r(e,["uri"],t);const o=i(n,["bytesBase64Encoded"]);o!=null&&r(e,["videoBytes"],X(o));const s=i(n,["mimeType"]);return s!=null&&r(e,["mimeType"],s),e}function fl(n){const e={},t=i(n,["image"]);t!=null&&r(e,["_self"],J(t));const o=i(n,["maskMode"]);return o!=null&&r(e,["maskMode"],o),e}function cl(n){const e={},t=i(n,["image"]);t!=null&&r(e,["image"],ge(t));const o=i(n,["referenceType"]);return o!=null&&r(e,["referenceType"],o),e}function pl(n){const e={},t=i(n,["image"]);t!=null&&r(e,["image"],J(t));const o=i(n,["referenceType"]);return o!=null&&r(e,["referenceType"],o),e}function Lt(n){const e={},t=i(n,["uri"]);t!=null&&r(e,["uri"],t);const o=i(n,["videoBytes"]);o!=null&&r(e,["encodedVideo"],X(o));const s=i(n,["mimeType"]);return s!=null&&r(e,["encoding"],s),e}function kt(n){const e={},t=i(n,["uri"]);t!=null&&r(e,["gcsUri"],t);const o=i(n,["videoBytes"]);o!=null&&r(e,["bytesBase64Encoded"],X(o));const s=i(n,["mimeType"]);return s!=null&&r(e,["mimeType"],s),e}const ml="Content-Type",hl="X-Server-Timeout",gl="User-Agent",Re="x-goog-api-client",yl="1.29.0",Tl=`google-genai-sdk/${yl}`,El="v1beta1",_l="v1beta",st=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class Cl{constructor(e){var t,o;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});const s={};this.clientOptions.vertexai?(s.apiVersion=(t=this.clientOptions.apiVersion)!==null&&t!==void 0?t:El,s.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(s.apiVersion=(o=this.clientOptions.apiVersion)!==null&&o!==void 0?o:_l,s.baseUrl="https://generativelanguage.googleapis.com/"),s.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=s,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(s,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&this.clientOptions.location!=="global"?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const o=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&o.push(e.apiVersion),o.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,o){const s=[this.getRequestUrlInternal(t)];return o&&s.push(this.getBaseResourcePath()),e!==""&&s.push(e),new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const o=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,o);if(e.queryParams)for(const[a,u]of Object.entries(e.queryParams))s.searchParams.append(a,String(u));let l={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else l.body=e.body;return l=await this.includeExtraHttpOptionsToRequestInit(l,t,s.toString(),e.abortSignal),this.unaryApiCall(s,l,e.httpMethod)}patchHttpOptions(e,t){const o=JSON.parse(JSON.stringify(e));for(const[s,l]of Object.entries(t))typeof l=="object"?o[s]=Object.assign(Object.assign({},o[s]),l):l!==void 0&&(o[s]=l);return o}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const o=this.shouldPrependVertexProjectPath(e),s=this.constructUrl(e.path,t,o);(!s.searchParams.has("alt")||s.searchParams.get("alt")!=="sse")&&s.searchParams.set("alt","sse");let l={};return l.body=e.body,l=await this.includeExtraHttpOptionsToRequestInit(l,t,s.toString(),e.abortSignal),this.streamApiCall(s,l,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,o,s){if(t&&t.timeout||s){const l=new AbortController,a=l.signal;if(t.timeout&&t?.timeout>0){const u=setTimeout(()=>l.abort(),t.timeout);u&&typeof u.unref=="function"&&u.unref()}s&&s.addEventListener("abort",()=>{l.abort()}),e.signal=a}return t&&t.extraBody!==null&&vl(e,t.extraBody),e.headers=await this.getHeadersInternal(t,o),e}async unaryApiCall(e,t,o){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:o})).then(async s=>(await rt(s),new Ce(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}async streamApiCall(e,t,o){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:o})).then(async s=>(await rt(s),this.processStreamResponse(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}processStreamResponse(e){var t;return j(this,arguments,function*(){const s=(t=e?.body)===null||t===void 0?void 0:t.getReader(),l=new TextDecoder("utf-8");if(!s)throw new Error("Response body is empty");try{let a="";for(;;){const{done:u,value:f}=yield w(s.read());if(u){if(a.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const d=l.decode(f,{stream:!0});try{const p=JSON.parse(d);if("error"in p){const m=JSON.parse(JSON.stringify(p.error)),h=m.status,g=m.code,y=`got status: ${h}. ${JSON.stringify(p)}`;if(g>=400&&g<600)throw new pe({message:y,status:g})}}catch(p){if(p.name==="ApiError")throw p}a+=d;let c=a.match(st);for(;c;){const p=c[1];try{const m=new Response(p,{headers:e?.headers,status:e?.status,statusText:e?.statusText});yield yield w(new Ce(m)),a=a.slice(c[0].length),c=a.match(st)}catch(m){throw new Error(`exception parsing stream chunk ${p}. ${m}`)}}}}finally{s.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(o=>{throw new Error(`exception ${o} sending request`)})}getDefaultHeaders(){const e={},t=Tl+" "+this.clientOptions.userAgentExtra;return e[gl]=t,e[Re]=t,e[ml]="application/json",e}async getHeadersInternal(e,t){const o=new Headers;if(e&&e.headers){for(const[s,l]of Object.entries(e.headers))o.append(s,l);e.timeout&&e.timeout>0&&o.append(hl,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(o,t),o}getFileName(e){var t;let o="";return typeof e=="string"&&(o=e.replace(/[/\\]+$/,""),o=(t=o.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),o}async uploadFile(e,t){var o;const s={};t!=null&&(s.mimeType=t.mimeType,s.name=t.name,s.displayName=t.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);const l=this.clientOptions.uploader,a=await l.stat(e);s.sizeBytes=String(a.size);const u=(o=t?.mimeType)!==null&&o!==void 0?o:a.type;if(u===void 0||u==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=u;const f={file:s},d=this.getFileName(e),c=T("upload/v1beta/files",f._url),p=await this.fetchUploadUrl(c,s.sizeBytes,s.mimeType,d,f,t?.httpOptions);return l.upload(e,p,this)}async uploadFileToFileSearchStore(e,t,o){var s;const l=this.clientOptions.uploader,a=await l.stat(t),u=String(a.size),f=(s=o?.mimeType)!==null&&s!==void 0?s:a.type;if(f===void 0||f==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const d=`upload/v1beta/${e}:uploadToFileSearchStore`,c=this.getFileName(t),p={};o?.customMetadata&&(p.customMetadata=o.customMetadata),o?.chunkingConfig&&(p.chunkingConfig=o.chunkingConfig);const m=await this.fetchUploadUrl(d,u,f,c,p,o?.httpOptions);return l.uploadToFileSearchStore(t,m,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,o,s,l,a){var u;let f={};a?f=a:f={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${o}`},s?{"X-Goog-Upload-File-Name":s}:{})};const d=await this.request({path:e,body:JSON.stringify(l),httpMethod:"POST",httpOptions:f});if(!d||!d?.headers)throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const c=(u=d?.headers)===null||u===void 0?void 0:u["x-goog-upload-url"];if(c===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return c}}async function rt(n){var e;if(n===void 0)throw new Error("response is undefined");if(!n.ok){const t=n.status;let o;!((e=n.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?o=await n.json():o={error:{message:await n.text(),code:n.status,status:n.statusText}};const s=JSON.stringify(o);throw t>=400&&t<600?new pe({message:s,status:t}):new Error(s)}}function vl(n,e){if(!e||Object.keys(e).length===0)return;if(n.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof n.body=="string"&&n.body.length>0)try{const l=JSON.parse(n.body);if(typeof l=="object"&&l!==null&&!Array.isArray(l))t=l;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function o(l,a){const u=Object.assign({},l);for(const f in a)if(Object.prototype.hasOwnProperty.call(a,f)){const d=a[f],c=u[f];d&&typeof d=="object"&&!Array.isArray(d)&&c&&typeof c=="object"&&!Array.isArray(c)?u[f]=o(c,d):(c&&d&&typeof c!=typeof d&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${f}". Original type: ${typeof c}, New type: ${typeof d}. Overwriting.`),u[f]=d)}return u}const s=o(t,e);n.body=JSON.stringify(s)}const Sl="mcp_used/unknown";let Il=!1;function Ft(n){for(const e of n)if(Al(e)||typeof e=="object"&&"inputSchema"in e)return!0;return Il}function Vt(n){var e;const t=(e=n[Re])!==null&&e!==void 0?e:"";n[Re]=(t+` ${Sl}`).trimStart()}function Al(n){return n!==null&&typeof n=="object"&&n instanceof Ve}function Rl(n,e=100){return j(this,arguments,function*(){let o,s=0;for(;s<e;){const l=yield w(n.listTools({cursor:o}));for(const a of l.tools)yield yield w(a),s++;if(!l.nextCursor)break;o=l.nextCursor}})}class Ve{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new Ve(e,t)}async initialize(){var e,t,o,s;if(this.mcpTools.length>0)return;const l={},a=[];for(const c of this.mcpClients)try{for(var u=!0,f=(t=void 0,se(Rl(c))),d;d=await f.next(),e=d.done,!e;u=!0){s=d.value,u=!1;const p=s;a.push(p);const m=p.name;if(l[m])throw new Error(`Duplicate function name ${m} found in MCP tools. Please ensure function names are unique.`);l[m]=c}}catch(p){t={error:p}}finally{try{!u&&!e&&(o=f.return)&&await o.call(f)}finally{if(t)throw t.error}}this.mcpTools=a,this.functionNameToMcpClient=l}async tool(){return await this.initialize(),Do(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const o of e)if(o.name in this.functionNameToMcpClient){const s=this.functionNameToMcpClient[o.name];let l;this.config.timeout&&(l={timeout:this.config.timeout});const a=await s.callTool({name:o.name,arguments:o.args},void 0,l);t.push({functionResponse:{name:o.name,response:a.isError?{error:a}:a}})}return t}}async function Pl(n,e,t){const o=new So;let s;t.data instanceof Blob?s=JSON.parse(await t.data.text()):s=JSON.parse(t.data),Object.assign(o,s),e(o)}class Ml{constructor(e,t,o){this.apiClient=e,this.auth=t,this.webSocketFactory=o}async connect(e){var t,o;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const s=this.apiClient.getWebsocketBaseUrl(),l=this.apiClient.getApiVersion(),a=Dl(this.apiClient.getDefaultHeaders()),u=this.apiClient.getApiKey(),f=`${s}/ws/google.ai.generativelanguage.${l}.GenerativeService.BidiGenerateMusic?key=${u}`;let d=()=>{};const c=new Promise(E=>{d=E}),p=e.callbacks,m=function(){d({})},h=this.apiClient,g={onopen:m,onmessage:E=>{Pl(h,p.onmessage,E)},onerror:(t=p?.onerror)!==null&&t!==void 0?t:function(E){},onclose:(o=p?.onclose)!==null&&o!==void 0?o:function(E){}},y=this.webSocketFactory.create(f,wl(a),g);y.connect(),await c;const v={setup:{model:M(this.apiClient,e.model)}};return y.send(JSON.stringify(v)),new Nl(y,this.apiClient)}}class Nl{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=_s(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=Es(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){const t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Q.PLAY)}pause(){this.sendPlaybackControl(Q.PAUSE)}stop(){this.sendPlaybackControl(Q.STOP)}resetContext(){this.sendPlaybackControl(Q.RESET_CONTEXT)}close(){this.conn.close()}}function wl(n){const e={};return n.forEach((t,o)=>{e[o]=t}),e}function Dl(n){const e=new Headers;for(const[t,o]of Object.entries(n))e.append(t,o);return e}const xl="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Ul(n,e,t){const o=new vo;let s;t.data instanceof Blob?s=await t.data.text():t.data instanceof ArrayBuffer?s=new TextDecoder().decode(t.data):s=t.data;const l=JSON.parse(s);if(n.isVertexAI()){const a=Ss(l);Object.assign(o,a)}else Object.assign(o,l);e(o)}class Ll{constructor(e,t,o){this.apiClient=e,this.auth=t,this.webSocketFactory=o,this.music=new Ml(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,o,s,l,a,u;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const f=this.apiClient.getWebsocketBaseUrl(),d=this.apiClient.getApiVersion();let c;const p=this.apiClient.getHeaders();e.config&&e.config.tools&&Ft(e.config.tools)&&Vt(p);const m=Gl(p);if(this.apiClient.isVertexAI())c=`${f}/ws/google.cloud.aiplatform.${d}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(m,c);else{const I=this.apiClient.getApiKey();let N="BidiGenerateContent",L="key";I?.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),d!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),N="BidiGenerateContentConstrained",L="access_token"),c=`${f}/ws/google.ai.generativelanguage.${d}.GenerativeService.${N}?${L}=${I}`}let h=()=>{};const g=new Promise(I=>{h=I}),y=e.callbacks,_=function(){var I;(I=y?.onopen)===null||I===void 0||I.call(y),h({})},C=this.apiClient,v={onopen:_,onmessage:I=>{Ul(C,y.onmessage,I)},onerror:(t=y?.onerror)!==null&&t!==void 0?t:function(I){},onclose:(o=y?.onclose)!==null&&o!==void 0?o:function(I){}},E=this.webSocketFactory.create(c,Vl(m),v);E.connect(),await g;let S=M(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&S.startsWith("publishers/")){const I=this.apiClient.getProject(),N=this.apiClient.getLocation();S=`projects/${I}/locations/${N}/`+S}let A={};this.apiClient.isVertexAI()&&((s=e.config)===null||s===void 0?void 0:s.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[ue.AUDIO]}:e.config.responseModalities=[ue.AUDIO]),!((l=e.config)===null||l===void 0)&&l.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const R=(u=(a=e.config)===null||a===void 0?void 0:a.tools)!==null&&u!==void 0?u:[],P=[];for(const I of R)if(this.isCallableTool(I)){const N=I;P.push(await N.tool())}else P.push(I);P.length>0&&(e.config.tools=P);const F={model:S,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?A=Ts(this.apiClient,F):A=ys(this.apiClient,F),delete A.config,E.send(JSON.stringify(A)),new Fl(E,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const kl={turnComplete:!0};class Fl{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let o=[];try{o=B(t.turns),e.isVertexAI()||(o=o.map(s=>me(s)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:o,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let o=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?o=t.functionResponses:o=[t.functionResponses],o.length===0)throw new Error("functionResponses is required.");for(const l of o){if(typeof l!="object"||l===null||!("name"in l)||!("response"in l))throw new Error(`Could not parse function response, type '${typeof l}'.`);if(!e.isVertexAI()&&!("id"in l))throw new Error(xl)}return{toolResponse:{functionResponses:o}}}sendClientContent(e){e=Object.assign(Object.assign({},kl),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:vs(e)}:t={realtimeInput:Cs(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function Vl(n){const e={};return n.forEach((t,o)=>{e[o]=t}),e}function Gl(n){const e=new Headers;for(const[t,o]of Object.entries(n))e.append(t,o);return e}const lt=10;function at(n){var e,t,o;if(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let s=!1;for(const a of(t=n?.tools)!==null&&t!==void 0?t:[])if(ee(a)){s=!0;break}if(!s)return!0;const l=(o=n?.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls;return l&&(l<0||!Number.isInteger(l))||l==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",l),!0):!1}function ee(n){return"callTool"in n&&typeof n.callTool=="function"}function ql(n){var e,t,o;return(o=(t=(e=n.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(s=>ee(s)))!==null&&o!==void 0?o:!1}function ut(n){var e;const t=[];return!((e=n?.config)===null||e===void 0)&&e.tools&&n.config.tools.forEach((o,s)=>{if(ee(o))return;const l=o;l.functionDeclarations&&l.functionDeclarations.length>0&&t.push(s)}),t}function dt(n){var e;return!(!((e=n?.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}class Hl extends K{constructor(e){super(),this.apiClient=e,this.generateContent=async t=>{var o,s,l,a,u;const f=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!ql(t)||at(t.config))return await this.generateContentInternal(f);const d=ut(t);if(d.length>0){const y=d.map(_=>`tools[${_}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${y}.`)}let c,p;const m=B(f.contents),h=(l=(s=(o=f.config)===null||o===void 0?void 0:o.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&l!==void 0?l:lt;let g=0;for(;g<h&&(c=await this.generateContentInternal(f),!(!c.functionCalls||c.functionCalls.length===0));){const y=c.candidates[0].content,_=[];for(const C of(u=(a=t.config)===null||a===void 0?void 0:a.tools)!==null&&u!==void 0?u:[])if(ee(C)){const E=await C.callTool(c.functionCalls);_.push(...E)}g++,p={role:"user",parts:_},f.contents=B(f.contents),f.contents.push(y),f.contents.push(p),dt(f.config)&&(m.push(y),m.push(p))}return dt(f.config)&&(c.automaticFunctionCallingHistory=m),c},this.generateContentStream=async t=>{if(this.maybeMoveToResponseJsonSchem(t),at(t.config)){const s=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(s)}const o=ut(t);if(o.length>0){const s=o.map(l=>`tools[${l}]`).join(", ");throw new Error(`Incompatible tools found at ${s}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(o=>{var s;let l;const a=[];if(o?.generatedImages)for(const f of o.generatedImages)f&&f?.safetyAttributes&&((s=f?.safetyAttributes)===null||s===void 0?void 0:s.contentType)==="Positive Prompt"?l=f?.safetyAttributes:a.push(f);let u;return l?u={generatedImages:a,positivePromptSafetyAttributes:l,sdkHttpResponse:o.sdkHttpResponse}:u={generatedImages:a,sdkHttpResponse:o.sdkHttpResponse},u}),this.list=async t=>{var o;const a={config:Object.assign(Object.assign({},{queryBase:!0}),t?.config)};if(this.apiClient.isVertexAI()&&!a.config.queryBase){if(!((o=a.config)===null||o===void 0)&&o.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");a.config.filter="labels.tune-type:*"}return new O(W.PAGED_ITEM_MODELS,u=>this.listInternal(u),await this.listInternal(a),a)},this.editImage=async t=>{const o={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(o.referenceImages=t.referenceImages.map(s=>s.toReferenceImageAPI())),await this.editImageInternal(o)},this.upscaleImage=async t=>{let o={numberOfImages:1,mode:"upscale"};t.config&&(o=Object.assign(Object.assign({},o),t.config));const s={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:o};return await this.upscaleImageInternal(s)},this.generateVideos=async t=>{var o,s,l,a,u,f;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((o=t.video)===null||o===void 0)&&o.uri&&(!((s=t.video)===null||s===void 0)&&s.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((a=(l=t.source)===null||l===void 0?void 0:l.video)===null||a===void 0)&&a.uri&&(!((f=(u=t.source)===null||u===void 0?void 0:u.video)===null||f===void 0)&&f.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,o,s;const l=(t=e.config)===null||t===void 0?void 0:t.tools;if(!l)return e;const a=await Promise.all(l.map(async f=>ee(f)?await f.tool():f)),u={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:a})};if(u.config.tools=a,e.config&&e.config.tools&&Ft(e.config.tools)){const f=(s=(o=e.config.httpOptions)===null||o===void 0?void 0:o.headers)!==null&&s!==void 0?s:{};let d=Object.assign({},f);Object.keys(d).length===0&&(d=this.apiClient.getDefaultHeaders()),Vt(d),u.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:d})}return u}async initAfcToolsMap(e){var t,o,s;const l=new Map;for(const a of(o=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&o!==void 0?o:[])if(ee(a)){const u=a,f=await u.tool();for(const d of(s=f.functionDeclarations)!==null&&s!==void 0?s:[]){if(!d.name)throw new Error("Function declaration name is required.");if(l.has(d.name))throw new Error(`Duplicate tool declaration name: ${d.name}`);l.set(d.name,u)}}return l}async processAfcStream(e){var t,o,s;const l=(s=(o=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||o===void 0?void 0:o.maximumRemoteCalls)!==null&&s!==void 0?s:lt;let a=!1,u=0;const f=await this.initAfcToolsMap(e);return(function(d,c,p){var m,h;return j(this,arguments,function*(){for(var g,y,_,C;u<l;){a&&(u++,a=!1);const A=yield w(d.processParamsMaybeAddMcpUsage(p)),R=yield w(d.generateContentStreamInternal(A)),P=[],F=[];try{for(var v=!0,E=(y=void 0,se(R)),S;S=yield w(E.next()),g=S.done,!g;v=!0){C=S.value,v=!1;const I=C;if(yield yield w(I),I.candidates&&(!((m=I.candidates[0])===null||m===void 0)&&m.content)){F.push(I.candidates[0].content);for(const N of(h=I.candidates[0].content.parts)!==null&&h!==void 0?h:[])if(u<l&&N.functionCall){if(!N.functionCall.name)throw new Error("Function call name was not returned by the model.");if(c.has(N.functionCall.name)){const L=yield w(c.get(N.functionCall.name).callTool([N.functionCall]));P.push(...L)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${c.keys()}, mising tool: ${N.functionCall.name}`)}}}}catch(I){y={error:I}}finally{try{!v&&!g&&(_=E.return)&&(yield w(_.call(E)))}finally{if(y)throw y.error}}if(P.length>0){a=!0;const I=new ie;I.candidates=[{content:{role:"user",parts:P}}],yield yield w(I);const N=[];N.push(...F),N.push({role:"user",parts:P});const L=B(p.contents).concat(N);p.contents=L}else break}})})(this,f,e)}async generateContentInternal(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=tt(this.apiClient,e);return u=T("{model}:generateContent",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=it(c),m=new ie;return Object.assign(m,p),m})}else{const d=nt(this.apiClient,e);return u=T("{model}:generateContent",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=ot(c),m=new ie;return Object.assign(m,p),m})}}async generateContentStreamInternal(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=tt(this.apiClient,e);return u=T("{model}:streamGenerateContent?alt=sse",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.requestStream({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),a.then(function(p){return j(this,arguments,function*(){var m,h,g,y;try{for(var _=!0,C=se(p),v;v=yield w(C.next()),m=v.done,!m;_=!0){y=v.value,_=!1;const E=y,S=it(yield w(E.json()));S.sdkHttpResponse={headers:E.headers};const A=new ie;Object.assign(A,S),yield yield w(A)}}catch(E){h={error:E}}finally{try{!_&&!m&&(g=C.return)&&(yield w(g.call(C)))}finally{if(h)throw h.error}}})})}else{const d=nt(this.apiClient,e);return u=T("{model}:streamGenerateContent?alt=sse",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.requestStream({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}),a.then(function(p){return j(this,arguments,function*(){var m,h,g,y;try{for(var _=!0,C=se(p),v;v=yield w(C.next()),m=v.done,!m;_=!0){y=v.value,_=!1;const E=y,S=ot(yield w(E.json()));S.sdkHttpResponse={headers:E.headers};const A=new ie;Object.assign(A,S),yield yield w(A)}}catch(E){h={error:E}}finally{try{!_&&!m&&(g=C.return)&&(yield w(g.call(C)))}finally{if(h)throw h.error}}})})}}async embedContent(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=js(this.apiClient,e);return u=T("{model}:predict",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=nr(c),m=new qn;return Object.assign(m,p),m})}else{const d=Zs(this.apiClient,e);return u=T("{model}:batchEmbedContents",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=er(c),m=new qn;return Object.assign(m,p),m})}}async generateImagesInternal(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=dr(this.apiClient,e);return u=T("{model}:predict",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=cr(c),m=new Hn;return Object.assign(m,p),m})}else{const d=ur(this.apiClient,e);return u=T("{model}:predict",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=fr(c),m=new Hn;return Object.assign(m,p),m})}}async editImageInternal(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI()){const u=zs(this.apiClient,e);return l=T("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(d=>{const c=d;return c.sdkHttpResponse={headers:f.headers},c})),s.then(f=>{const d=Xs(f),c=new fo;return Object.assign(c,d),c})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI()){const u=ll(this.apiClient,e);return l=T("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(d=>{const c=d;return c.sdkHttpResponse={headers:f.headers},c})),s.then(f=>{const d=al(f),c=new co;return Object.assign(c,d),c})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI()){const u=$r(this.apiClient,e);return l=T("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),s.then(f=>{const d=Yr(f),c=new po;return Object.assign(c,d),c})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI()){const u=Or(this.apiClient,e);return l=T("{model}:predict",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),s.then(f=>{const d=Qr(f),c=new mo;return Object.assign(c,d),c})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=Nr(this.apiClient,e);return u=T("{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json()),a.then(c=>Ae(c))}else{const d=Mr(this.apiClient,e);return u=T("{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json()),a.then(c=>Ie(c))}}async listInternal(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=Fr(this.apiClient,e);return u=T("{models_url}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=Gr(c),m=new Bn;return Object.assign(m,p),m})}else{const d=kr(this.apiClient,e);return u=T("{models_url}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=Vr(c),m=new Bn;return Object.assign(m,p),m})}}async update(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=sl(this.apiClient,e);return u=T("{model}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json()),a.then(c=>Ae(c))}else{const d=il(this.apiClient,e);return u=T("{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json()),a.then(c=>Ie(c))}}async delete(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=Ys(this.apiClient,e);return u=T("{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=Ws(c),m=new Jn;return Object.assign(m,p),m})}else{const d=$s(this.apiClient,e);return u=T("{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=bs(c),m=new Jn;return Object.assign(m,p),m})}}async countTokens(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=Hs(this.apiClient,e);return u=T("{model}:countTokens",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=Js(c),m=new $n;return Object.assign(m,p),m})}else{const d=qs(this.apiClient,e);return u=T("{model}:countTokens",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=Bs(c),m=new $n;return Object.assign(m,p),m})}}async computeTokens(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI()){const u=xs(this.apiClient,e);return l=T("{model}:computeTokens",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(d=>{const c=d;return c.sdkHttpResponse={headers:f.headers},c})),s.then(f=>{const d=Us(f),c=new ho;return Object.assign(c,d),c})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=Tr(this.apiClient,e);return u=T("{model}:predictLongRunning",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json()),a.then(c=>{const p=gr(c),m=new de;return Object.assign(m,p),m})}else{const d=yr(this.apiClient,e);return u=T("{model}:predictLongRunning",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json()),a.then(c=>{const p=hr(c),m=new de;return Object.assign(m,p),m})}}}class Bl extends K{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,o=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=t.name.split("/operations/")[0];let l;o&&"httpOptions"in o&&(l=o.httpOptions);const a=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:l}});return t._fromAPIResponse({apiResponse:a,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:t.name,config:o});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async get(e){const t=e.operation,o=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=t.name.split("/operations/")[0];let l;o&&"httpOptions"in o&&(l=o.httpOptions);const a=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:l}});return t._fromAPIResponse({apiResponse:a,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:t.name,config:o});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=io(e);return u=T("{operationName}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json()),a}else{const d=oo(e);return u=T("{operationName}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json()),a}}async fetchPredictVideosOperationInternal(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI()){const u=Ot(e);return l=T("{resourceName}:fetchPredictOperation",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),s}else throw new Error("This method is only supported by the Vertex AI.")}}function Jl(n){const e={},t=i(n,["data"]);if(t!=null&&r(e,["data"],t),i(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const o=i(n,["mimeType"]);return o!=null&&r(e,["mimeType"],o),e}function $l(n){const e={},t=i(n,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(l=>Ql(l))),r(e,["parts"],s)}const o=i(n,["role"]);return o!=null&&r(e,["role"],o),e}function Yl(n,e,t){const o={},s=i(e,["expireTime"]);t!==void 0&&s!=null&&r(t,["expireTime"],s);const l=i(e,["newSessionExpireTime"]);t!==void 0&&l!=null&&r(t,["newSessionExpireTime"],l);const a=i(e,["uses"]);t!==void 0&&a!=null&&r(t,["uses"],a);const u=i(e,["liveConnectConstraints"]);t!==void 0&&u!=null&&r(t,["bidiGenerateContentSetup"],Ol(n,u));const f=i(e,["lockAdditionalFields"]);return t!==void 0&&f!=null&&r(t,["fieldMask"],f),o}function bl(n,e){const t={},o=i(e,["config"]);return o!=null&&r(t,["config"],Yl(n,o,t)),t}function Wl(n){const e={};if(i(n,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=i(n,["fileUri"]);t!=null&&r(e,["fileUri"],t);const o=i(n,["mimeType"]);return o!=null&&r(e,["mimeType"],o),e}function Kl(n){const e={};if(i(n,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=i(n,["enableWidget"]);return t!=null&&r(e,["enableWidget"],t),e}function zl(n){const e={};if(i(n,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(i(n,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=i(n,["timeRangeFilter"]);return t!=null&&r(e,["timeRangeFilter"],t),e}function Xl(n,e){const t={},o=i(n,["generationConfig"]);e!==void 0&&o!=null&&r(e,["setup","generationConfig"],o);const s=i(n,["responseModalities"]);e!==void 0&&s!=null&&r(e,["setup","generationConfig","responseModalities"],s);const l=i(n,["temperature"]);e!==void 0&&l!=null&&r(e,["setup","generationConfig","temperature"],l);const a=i(n,["topP"]);e!==void 0&&a!=null&&r(e,["setup","generationConfig","topP"],a);const u=i(n,["topK"]);e!==void 0&&u!=null&&r(e,["setup","generationConfig","topK"],u);const f=i(n,["maxOutputTokens"]);e!==void 0&&f!=null&&r(e,["setup","generationConfig","maxOutputTokens"],f);const d=i(n,["mediaResolution"]);e!==void 0&&d!=null&&r(e,["setup","generationConfig","mediaResolution"],d);const c=i(n,["seed"]);e!==void 0&&c!=null&&r(e,["setup","generationConfig","seed"],c);const p=i(n,["speechConfig"]);e!==void 0&&p!=null&&r(e,["setup","generationConfig","speechConfig"],Fe(p));const m=i(n,["thinkingConfig"]);e!==void 0&&m!=null&&r(e,["setup","generationConfig","thinkingConfig"],m);const h=i(n,["enableAffectiveDialog"]);e!==void 0&&h!=null&&r(e,["setup","generationConfig","enableAffectiveDialog"],h);const g=i(n,["systemInstruction"]);e!==void 0&&g!=null&&r(e,["setup","systemInstruction"],$l(V(g)));const y=i(n,["tools"]);if(e!==void 0&&y!=null){let R=te(y);Array.isArray(R)&&(R=R.map(P=>jl(ne(P)))),r(e,["setup","tools"],R)}const _=i(n,["sessionResumption"]);e!==void 0&&_!=null&&r(e,["setup","sessionResumption"],Zl(_));const C=i(n,["inputAudioTranscription"]);e!==void 0&&C!=null&&r(e,["setup","inputAudioTranscription"],C);const v=i(n,["outputAudioTranscription"]);e!==void 0&&v!=null&&r(e,["setup","outputAudioTranscription"],v);const E=i(n,["realtimeInputConfig"]);e!==void 0&&E!=null&&r(e,["setup","realtimeInputConfig"],E);const S=i(n,["contextWindowCompression"]);e!==void 0&&S!=null&&r(e,["setup","contextWindowCompression"],S);const A=i(n,["proactivity"]);return e!==void 0&&A!=null&&r(e,["setup","proactivity"],A),t}function Ol(n,e){const t={},o=i(e,["model"]);o!=null&&r(t,["setup","model"],M(n,o));const s=i(e,["config"]);return s!=null&&r(t,["config"],Xl(s,t)),t}function Ql(n){const e={},t=i(n,["functionCall"]);t!=null&&r(e,["functionCall"],t);const o=i(n,["codeExecutionResult"]);o!=null&&r(e,["codeExecutionResult"],o);const s=i(n,["executableCode"]);s!=null&&r(e,["executableCode"],s);const l=i(n,["fileData"]);l!=null&&r(e,["fileData"],Wl(l));const a=i(n,["functionResponse"]);a!=null&&r(e,["functionResponse"],a);const u=i(n,["inlineData"]);u!=null&&r(e,["inlineData"],Jl(u));const f=i(n,["text"]);f!=null&&r(e,["text"],f);const d=i(n,["thought"]);d!=null&&r(e,["thought"],d);const c=i(n,["thoughtSignature"]);c!=null&&r(e,["thoughtSignature"],c);const p=i(n,["videoMetadata"]);return p!=null&&r(e,["videoMetadata"],p),e}function Zl(n){const e={},t=i(n,["handle"]);if(t!=null&&r(e,["handle"],t),i(n,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function jl(n){const e={},t=i(n,["functionDeclarations"]);if(t!=null){let c=t;Array.isArray(c)&&(c=c.map(p=>p)),r(e,["functionDeclarations"],c)}if(i(n,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const o=i(n,["googleSearchRetrieval"]);o!=null&&r(e,["googleSearchRetrieval"],o);const s=i(n,["computerUse"]);s!=null&&r(e,["computerUse"],s);const l=i(n,["fileSearch"]);l!=null&&r(e,["fileSearch"],l);const a=i(n,["codeExecution"]);if(a!=null&&r(e,["codeExecution"],a),i(n,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const u=i(n,["googleMaps"]);u!=null&&r(e,["googleMaps"],Kl(u));const f=i(n,["googleSearch"]);f!=null&&r(e,["googleSearch"],zl(f));const d=i(n,["urlContext"]);return d!=null&&r(e,["urlContext"],d),e}function ea(n){const e=[];for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t)){const o=n[t];if(typeof o=="object"&&o!=null&&Object.keys(o).length>0){const s=Object.keys(o).map(l=>`${t}.${l}`);e.push(...s)}else e.push(t)}return e.join(",")}function na(n,e){let t=null;const o=n.bidiGenerateContentSetup;if(typeof o=="object"&&o!==null&&"setup"in o){const l=o.setup;typeof l=="object"&&l!==null?(n.bidiGenerateContentSetup=l,t=l):delete n.bidiGenerateContentSetup}else o!==void 0&&delete n.bidiGenerateContentSetup;const s=n.fieldMask;if(t){const l=ea(t);if(Array.isArray(e?.lockAdditionalFields)&&e?.lockAdditionalFields.length===0)l?n.fieldMask=l:delete n.fieldMask;else if(e?.lockAdditionalFields&&e.lockAdditionalFields.length>0&&s!==null&&Array.isArray(s)&&s.length>0){const a=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let u=[];s.length>0&&(u=s.map(d=>a.includes(d)?`generationConfig.${d}`:d));const f=[];l&&f.push(l),u.length>0&&f.push(...u),f.length>0?n.fieldMask=f.join(","):delete n.fieldMask}else delete n.fieldMask}else s!==null&&Array.isArray(s)&&s.length>0?n.fieldMask=s.join(","):delete n.fieldMask;return n}class ta extends K{constructor(e){super(),this.apiClient=e}async create(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const u=bl(this.apiClient,e);l=T("auth_tokens",u._url),a=u._query,delete u.config,delete u._url,delete u._query;const f=na(u,e.config);return s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(d=>d.json()),s.then(d=>d)}}}function oa(n,e){const t={},o=i(n,["displayName"]);return e!==void 0&&o!=null&&r(e,["displayName"],o),t}function ia(n){const e={},t=i(n,["config"]);return t!=null&&oa(t,e),e}function sa(n,e){const t={},o=i(n,["force"]);return e!==void 0&&o!=null&&r(e,["_query","force"],o),t}function ra(n){const e={},t=i(n,["name"]);t!=null&&r(e,["_url","name"],t);const o=i(n,["config"]);return o!=null&&sa(o,e),e}function la(n){const e={},t=i(n,["name"]);return t!=null&&r(e,["_url","name"],t),e}function aa(n,e){const t={},o=i(n,["customMetadata"]);if(e!==void 0&&o!=null){let l=o;Array.isArray(l)&&(l=l.map(a=>a)),r(e,["customMetadata"],l)}const s=i(n,["chunkingConfig"]);return e!==void 0&&s!=null&&r(e,["chunkingConfig"],s),t}function ua(n){const e={},t=i(n,["name"]);t!=null&&r(e,["name"],t);const o=i(n,["metadata"]);o!=null&&r(e,["metadata"],o);const s=i(n,["done"]);s!=null&&r(e,["done"],s);const l=i(n,["error"]);l!=null&&r(e,["error"],l);const a=i(n,["response"]);return a!=null&&r(e,["response"],fa(a)),e}function da(n){const e={},t=i(n,["fileSearchStoreName"]);t!=null&&r(e,["_url","file_search_store_name"],t);const o=i(n,["fileName"]);o!=null&&r(e,["fileName"],o);const s=i(n,["config"]);return s!=null&&aa(s,e),e}function fa(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["parent"]);o!=null&&r(e,["parent"],o);const s=i(n,["documentName"]);return s!=null&&r(e,["documentName"],s),e}function ca(n,e){const t={},o=i(n,["pageSize"]);e!==void 0&&o!=null&&r(e,["_query","pageSize"],o);const s=i(n,["pageToken"]);return e!==void 0&&s!=null&&r(e,["_query","pageToken"],s),t}function pa(n){const e={},t=i(n,["config"]);return t!=null&&ca(t,e),e}function ma(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["nextPageToken"]);o!=null&&r(e,["nextPageToken"],o);const s=i(n,["fileSearchStores"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(a=>a)),r(e,["fileSearchStores"],l)}return e}function ha(n,e){const t={},o=i(n,["mimeType"]);e!==void 0&&o!=null&&r(e,["mimeType"],o);const s=i(n,["displayName"]);e!==void 0&&s!=null&&r(e,["displayName"],s);const l=i(n,["customMetadata"]);if(e!==void 0&&l!=null){let u=l;Array.isArray(u)&&(u=u.map(f=>f)),r(e,["customMetadata"],u)}const a=i(n,["chunkingConfig"]);return e!==void 0&&a!=null&&r(e,["chunkingConfig"],a),t}function ga(n){const e={},t=i(n,["fileSearchStoreName"]);t!=null&&r(e,["_url","file_search_store_name"],t);const o=i(n,["config"]);return o!=null&&ha(o,e),e}function ya(n){const e={},t=i(n,["sdkHttpResponse"]);return t!=null&&r(e,["sdkHttpResponse"],t),e}function Ta(n,e){const t={},o=i(n,["force"]);return e!==void 0&&o!=null&&r(e,["_query","force"],o),t}function Ea(n){const e={},t=i(n,["name"]);t!=null&&r(e,["_url","name"],t);const o=i(n,["config"]);return o!=null&&Ta(o,e),e}function _a(n){const e={},t=i(n,["name"]);return t!=null&&r(e,["_url","name"],t),e}function Ca(n,e){const t={},o=i(n,["pageSize"]);e!==void 0&&o!=null&&r(e,["_query","pageSize"],o);const s=i(n,["pageToken"]);return e!==void 0&&s!=null&&r(e,["_query","pageToken"],s),t}function va(n){const e={},t=i(n,["parent"]);t!=null&&r(e,["_url","parent"],t);const o=i(n,["config"]);return o!=null&&Ca(o,e),e}function Sa(n){const e={},t=i(n,["sdkHttpResponse"]);t!=null&&r(e,["sdkHttpResponse"],t);const o=i(n,["nextPageToken"]);o!=null&&r(e,["nextPageToken"],o);const s=i(n,["documents"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(a=>a)),r(e,["documents"],l)}return e}class Ia extends K{constructor(e){super(),this.apiClient=e,this.list=async t=>new O(W.PAGED_ITEM_DOCUMENTS,o=>this.listInternal({parent:t.parent,config:o.config}),await this.listInternal(t),t)}async get(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=_a(e);return l=T("{name}",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),s.then(f=>f)}}async delete(e){var t,o;let s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=Ea(e);s=T("{name}",a._url),l=a._query,delete a._url,delete a._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=va(e);return l=T("{parent}/documents",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),s.then(f=>{const d=Sa(f),c=new go;return Object.assign(c,d),c})}}}class Aa extends K{constructor(e,t=new Ia(e)){super(),this.apiClient=e,this.documents=t,this.list=async(o={})=>new O(W.PAGED_ITEM_FILE_SEARCH_STORES,s=>this.listInternal(s),await this.listInternal(o),o)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=ia(e);return l=T("fileSearchStores",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),s.then(f=>f)}}async get(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=la(e);return l=T("{name}",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),s.then(f=>f)}}async delete(e){var t,o;let s="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const a=ra(e);s=T("{name}",a._url),l=a._query,delete a._url,delete a._query,await this.apiClient.request({path:s,queryParams:l,body:JSON.stringify(a),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=pa(e);return l=T("fileSearchStores",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),s.then(f=>{const d=ma(f),c=new yo;return Object.assign(c,d),c})}}async uploadToFileSearchStoreInternal(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=ga(e);return l=T("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),s.then(f=>{const d=ya(f),c=new To;return Object.assign(c,d),c})}}async importFile(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=da(e);return l=T("{file_search_store_name}:importFile",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json()),s.then(f=>{const d=ua(f),c=new De;return Object.assign(c,d),c})}}}function Ra(n,e){const t={},o=i(n,["name"]);return o!=null&&r(t,["_url","name"],o),t}function Pa(n,e){const t={},o=i(n,["name"]);return o!=null&&r(t,["_url","name"],o),t}function Ma(n,e,t){const o={};if(i(n,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const s=i(n,["tunedModelDisplayName"]);if(e!==void 0&&s!=null&&r(e,["displayName"],s),i(n,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const l=i(n,["epochCount"]);e!==void 0&&l!=null&&r(e,["tuningTask","hyperparameters","epochCount"],l);const a=i(n,["learningRateMultiplier"]);if(a!=null&&r(o,["tuningTask","hyperparameters","learningRateMultiplier"],a),i(n,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(i(n,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(i(n,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");const u=i(n,["batchSize"]);e!==void 0&&u!=null&&r(e,["tuningTask","hyperparameters","batchSize"],u);const f=i(n,["learningRate"]);if(e!==void 0&&f!=null&&r(e,["tuningTask","hyperparameters","learningRate"],f),i(n,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(i(n,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");return o}function Na(n,e,t){const o={};let s=i(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const h=i(n,["validationDataset"]);e!==void 0&&h!=null&&r(e,["supervisedTuningSpec"],ft(h))}else if(s==="PREFERENCE_TUNING"){const h=i(n,["validationDataset"]);e!==void 0&&h!=null&&r(e,["preferenceOptimizationSpec"],ft(h))}const l=i(n,["tunedModelDisplayName"]);e!==void 0&&l!=null&&r(e,["tunedModelDisplayName"],l);const a=i(n,["description"]);e!==void 0&&a!=null&&r(e,["description"],a);let u=i(t,["config","method"]);if(u===void 0&&(u="SUPERVISED_FINE_TUNING"),u==="SUPERVISED_FINE_TUNING"){const h=i(n,["epochCount"]);e!==void 0&&h!=null&&r(e,["supervisedTuningSpec","hyperParameters","epochCount"],h)}else if(u==="PREFERENCE_TUNING"){const h=i(n,["epochCount"]);e!==void 0&&h!=null&&r(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],h)}let f=i(t,["config","method"]);if(f===void 0&&(f="SUPERVISED_FINE_TUNING"),f==="SUPERVISED_FINE_TUNING"){const h=i(n,["learningRateMultiplier"]);e!==void 0&&h!=null&&r(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],h)}else if(f==="PREFERENCE_TUNING"){const h=i(n,["learningRateMultiplier"]);e!==void 0&&h!=null&&r(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],h)}let d=i(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const h=i(n,["exportLastCheckpointOnly"]);e!==void 0&&h!=null&&r(e,["supervisedTuningSpec","exportLastCheckpointOnly"],h)}else if(d==="PREFERENCE_TUNING"){const h=i(n,["exportLastCheckpointOnly"]);e!==void 0&&h!=null&&r(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],h)}let c=i(t,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const h=i(n,["adapterSize"]);e!==void 0&&h!=null&&r(e,["supervisedTuningSpec","hyperParameters","adapterSize"],h)}else if(c==="PREFERENCE_TUNING"){const h=i(n,["adapterSize"]);e!==void 0&&h!=null&&r(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],h)}if(i(n,["batchSize"])!==void 0)throw new Error("batchSize parameter is not supported in Vertex AI.");if(i(n,["learningRate"])!==void 0)throw new Error("learningRate parameter is not supported in Vertex AI.");const p=i(n,["labels"]);e!==void 0&&p!=null&&r(e,["labels"],p);const m=i(n,["beta"]);return e!==void 0&&m!=null&&r(e,["preferenceOptimizationSpec","hyperParameters","beta"],m),o}function wa(n,e){const t={},o=i(n,["baseModel"]);o!=null&&r(t,["baseModel"],o);const s=i(n,["preTunedModel"]);s!=null&&r(t,["preTunedModel"],s);const l=i(n,["trainingDataset"]);l!=null&&Ba(l);const a=i(n,["config"]);return a!=null&&Ma(a,t),t}function Da(n,e){const t={},o=i(n,["baseModel"]);o!=null&&r(t,["baseModel"],o);const s=i(n,["preTunedModel"]);s!=null&&r(t,["preTunedModel"],s);const l=i(n,["trainingDataset"]);l!=null&&Ja(l,t,e);const a=i(n,["config"]);return a!=null&&Na(a,t,e),t}function xa(n,e){const t={},o=i(n,["name"]);return o!=null&&r(t,["_url","name"],o),t}function Ua(n,e){const t={},o=i(n,["name"]);return o!=null&&r(t,["_url","name"],o),t}function La(n,e,t){const o={},s=i(n,["pageSize"]);e!==void 0&&s!=null&&r(e,["_query","pageSize"],s);const l=i(n,["pageToken"]);e!==void 0&&l!=null&&r(e,["_query","pageToken"],l);const a=i(n,["filter"]);return e!==void 0&&a!=null&&r(e,["_query","filter"],a),o}function ka(n,e,t){const o={},s=i(n,["pageSize"]);e!==void 0&&s!=null&&r(e,["_query","pageSize"],s);const l=i(n,["pageToken"]);e!==void 0&&l!=null&&r(e,["_query","pageToken"],l);const a=i(n,["filter"]);return e!==void 0&&a!=null&&r(e,["_query","filter"],a),o}function Fa(n,e){const t={},o=i(n,["config"]);return o!=null&&La(o,t),t}function Va(n,e){const t={},o=i(n,["config"]);return o!=null&&ka(o,t),t}function Ga(n,e){const t={},o=i(n,["sdkHttpResponse"]);o!=null&&r(t,["sdkHttpResponse"],o);const s=i(n,["nextPageToken"]);s!=null&&r(t,["nextPageToken"],s);const l=i(n,["tunedModels"]);if(l!=null){let a=l;Array.isArray(a)&&(a=a.map(u=>Gt(u))),r(t,["tuningJobs"],a)}return t}function qa(n,e){const t={},o=i(n,["sdkHttpResponse"]);o!=null&&r(t,["sdkHttpResponse"],o);const s=i(n,["nextPageToken"]);s!=null&&r(t,["nextPageToken"],s);const l=i(n,["tuningJobs"]);if(l!=null){let a=l;Array.isArray(a)&&(a=a.map(u=>Pe(u))),r(t,["tuningJobs"],a)}return t}function Ha(n,e){const t={},o=i(n,["name"]);o!=null&&r(t,["model"],o);const s=i(n,["name"]);return s!=null&&r(t,["endpoint"],s),t}function Ba(n,e){const t={};if(i(n,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(i(n,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const o=i(n,["examples"]);if(o!=null){let s=o;Array.isArray(s)&&(s=s.map(l=>l)),r(t,["examples","examples"],s)}return t}function Ja(n,e,t){const o={};let s=i(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const a=i(n,["gcsUri"]);e!==void 0&&a!=null&&r(e,["supervisedTuningSpec","trainingDatasetUri"],a)}else if(s==="PREFERENCE_TUNING"){const a=i(n,["gcsUri"]);e!==void 0&&a!=null&&r(e,["preferenceOptimizationSpec","trainingDatasetUri"],a)}let l=i(t,["config","method"]);if(l===void 0&&(l="SUPERVISED_FINE_TUNING"),l==="SUPERVISED_FINE_TUNING"){const a=i(n,["vertexDatasetResource"]);e!==void 0&&a!=null&&r(e,["supervisedTuningSpec","trainingDatasetUri"],a)}else if(l==="PREFERENCE_TUNING"){const a=i(n,["vertexDatasetResource"]);e!==void 0&&a!=null&&r(e,["preferenceOptimizationSpec","trainingDatasetUri"],a)}if(i(n,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return o}function Gt(n,e){const t={},o=i(n,["sdkHttpResponse"]);o!=null&&r(t,["sdkHttpResponse"],o);const s=i(n,["name"]);s!=null&&r(t,["name"],s);const l=i(n,["state"]);l!=null&&r(t,["state"],Et(l));const a=i(n,["createTime"]);a!=null&&r(t,["createTime"],a);const u=i(n,["tuningTask","startTime"]);u!=null&&r(t,["startTime"],u);const f=i(n,["tuningTask","completeTime"]);f!=null&&r(t,["endTime"],f);const d=i(n,["updateTime"]);d!=null&&r(t,["updateTime"],d);const c=i(n,["description"]);c!=null&&r(t,["description"],c);const p=i(n,["baseModel"]);p!=null&&r(t,["baseModel"],p);const m=i(n,["_self"]);return m!=null&&r(t,["tunedModel"],Ha(m)),t}function Pe(n,e){const t={},o=i(n,["sdkHttpResponse"]);o!=null&&r(t,["sdkHttpResponse"],o);const s=i(n,["name"]);s!=null&&r(t,["name"],s);const l=i(n,["state"]);l!=null&&r(t,["state"],Et(l));const a=i(n,["createTime"]);a!=null&&r(t,["createTime"],a);const u=i(n,["startTime"]);u!=null&&r(t,["startTime"],u);const f=i(n,["endTime"]);f!=null&&r(t,["endTime"],f);const d=i(n,["updateTime"]);d!=null&&r(t,["updateTime"],d);const c=i(n,["error"]);c!=null&&r(t,["error"],c);const p=i(n,["description"]);p!=null&&r(t,["description"],p);const m=i(n,["baseModel"]);m!=null&&r(t,["baseModel"],m);const h=i(n,["tunedModel"]);h!=null&&r(t,["tunedModel"],h);const g=i(n,["preTunedModel"]);g!=null&&r(t,["preTunedModel"],g);const y=i(n,["supervisedTuningSpec"]);y!=null&&r(t,["supervisedTuningSpec"],y);const _=i(n,["preferenceOptimizationSpec"]);_!=null&&r(t,["preferenceOptimizationSpec"],_);const C=i(n,["tuningDataStats"]);C!=null&&r(t,["tuningDataStats"],C);const v=i(n,["encryptionSpec"]);v!=null&&r(t,["encryptionSpec"],v);const E=i(n,["partnerModelTuningSpec"]);E!=null&&r(t,["partnerModelTuningSpec"],E);const S=i(n,["customBaseModel"]);S!=null&&r(t,["customBaseModel"],S);const A=i(n,["experiment"]);A!=null&&r(t,["experiment"],A);const R=i(n,["labels"]);R!=null&&r(t,["labels"],R);const P=i(n,["outputUri"]);P!=null&&r(t,["outputUri"],P);const F=i(n,["pipelineJob"]);F!=null&&r(t,["pipelineJob"],F);const I=i(n,["serviceAccount"]);I!=null&&r(t,["serviceAccount"],I);const N=i(n,["tunedModelDisplayName"]);N!=null&&r(t,["tunedModelDisplayName"],N);const L=i(n,["veoTuningSpec"]);return L!=null&&r(t,["veoTuningSpec"],L),t}function $a(n,e){const t={},o=i(n,["sdkHttpResponse"]);o!=null&&r(t,["sdkHttpResponse"],o);const s=i(n,["name"]);s!=null&&r(t,["name"],s);const l=i(n,["metadata"]);l!=null&&r(t,["metadata"],l);const a=i(n,["done"]);a!=null&&r(t,["done"],a);const u=i(n,["error"]);return u!=null&&r(t,["error"],u),t}function ft(n,e){const t={},o=i(n,["gcsUri"]);o!=null&&r(t,["validationDatasetUri"],o);const s=i(n,["vertexDatasetResource"]);return s!=null&&r(t,["validationDatasetUri"],s),t}class Ya extends K{constructor(e){super(),this.apiClient=e,this.get=async t=>await this.getInternal(t),this.list=async(t={})=>new O(W.PAGED_ITEM_TUNING_JOBS,o=>this.listInternal(o),await this.listInternal(t),t),this.tune=async t=>{var o;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const s={tunedModelName:t.baseModel};!((o=t.config)===null||o===void 0)&&o.preTunedModelCheckpointId&&(s.checkpointId=t.config.preTunedModelCheckpointId);const l=Object.assign(Object.assign({},t),{preTunedModel:s});return l.baseModel=void 0,await this.tuneInternal(l)}else{const s=Object.assign({},t);return await this.tuneInternal(s)}else{const s=Object.assign({},t),l=await this.tuneMldevInternal(s);let a="";return l.metadata!==void 0&&l.metadata.tunedModel!==void 0?a=l.metadata.tunedModel:l.name!==void 0&&l.name.includes("/operations/")&&(a=l.name.split("/operations/")[0]),{name:a,state:_e.JOB_STATE_QUEUED}}}}async getInternal(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=Ua(e);return u=T("{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>Pe(c))}else{const d=xa(e);return u=T("{name}",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>Gt(c))}}async listInternal(e){var t,o,s,l;let a,u="",f={};if(this.apiClient.isVertexAI()){const d=Va(e);return u=T("tuningJobs",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=qa(c),m=new Yn;return Object.assign(m,p),m})}else{const d=Fa(e);return u=T("tunedModels",d._url),f=d._query,delete d._url,delete d._query,a=this.apiClient.request({path:u,queryParams:f,body:JSON.stringify(d),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal}).then(c=>c.json().then(p=>{const m=p;return m.sdkHttpResponse={headers:c.headers},m})),a.then(c=>{const p=Ga(c),m=new Yn;return Object.assign(m,p),m})}}async cancel(e){var t,o,s,l;let a="",u={};if(this.apiClient.isVertexAI()){const f=Pa(e);a=T("{name}:cancel",f._url),u=f._query,delete f._url,delete f._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}else{const f=Ra(e);a=T("{name}:cancel",f._url),u=f._query,delete f._url,delete f._query,await this.apiClient.request({path:a,queryParams:u,body:JSON.stringify(f),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(l=e.config)===null||l===void 0?void 0:l.abortSignal})}}async tuneInternal(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI()){const u=Da(e,e);return l=T("tuningJobs",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(d=>{const c=d;return c.sdkHttpResponse={headers:f.headers},c})),s.then(f=>Pe(f))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,o;let s,l="",a={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const u=wa(e);return l=T("tunedModels",u._url),a=u._query,delete u._url,delete u._query,s=this.apiClient.request({path:l,queryParams:a,body:JSON.stringify(u),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(f=>f.json().then(d=>{const c=d;return c.sdkHttpResponse={headers:f.headers},c})),s.then(f=>$a(f))}}}class ba{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const Wa=1024*1024*8,Ka=3,za=1e3,Xa=2,ce="x-goog-upload-status";async function Oa(n,e,t){var o;const s=await qt(n,e,t),l=await s?.json();if(((o=s?.headers)===null||o===void 0?void 0:o[ce])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return l.file}async function Qa(n,e,t){var o;const s=await qt(n,e,t),l=await s?.json();if(((o=s?.headers)===null||o===void 0?void 0:o[ce])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const a=pt(l),u=new xe;return Object.assign(u,a),u}async function qt(n,e,t){var o,s;let l=0,a=0,u=new Ce(new Response),f="upload";for(l=n.size;a<l;){const d=Math.min(Wa,l-a),c=n.slice(a,a+d);a+d>=l&&(f+=", finalize");let p=0,m=za;for(;p<Ka&&(u=await t.request({path:"",body:c,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":f,"X-Goog-Upload-Offset":String(a),"Content-Length":String(d)}}}),!(!((o=u?.headers)===null||o===void 0)&&o[ce]));)p++,await ja(m),m=m*Xa;if(a+=d,((s=u?.headers)===null||s===void 0?void 0:s[ce])!=="active")break;if(l<=a)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return u}async function Za(n){return{size:n.size,type:n.type}}function ja(n){return new Promise(e=>setTimeout(e,n))}class eu{async upload(e,t,o){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Oa(e,t,o)}async uploadToFileSearchStore(e,t,o){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Qa(e,t,o)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await Za(e)}}class nu{create(e,t,o){return new tu(e,t,o)}}class tu{constructor(e,t,o){this.url=e,this.headers=t,this.callbacks=o}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}const ct="x-goog-api-key";class ou{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(ct)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(ct,this.apiKey)}}}const iu="gl-node/";class su{constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const o=zt(e.httpOptions,e.vertexai,void 0,void 0);o&&(e.httpOptions?e.httpOptions.baseUrl=o:e.httpOptions={baseUrl:o}),this.apiVersion=e.apiVersion;const s=new ou(this.apiKey);this.apiClient=new Cl({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:iu+"web",uploader:new eu,downloader:new ba}),this.models=new Hl(this.apiClient),this.live=new Ll(this.apiClient,s,new nu),this.batches=new _i(this.apiClient),this.chats=new Zi(this.models,this.apiClient),this.caches=new Xi(this.apiClient),this.files=new as(this.apiClient),this.operations=new Bl(this.apiClient),this.authTokens=new ta(this.apiClient),this.tunings=new Ya(this.apiClient),this.fileSearchStores=new Aa(this.apiClient)}}const ru=void 0;console.warn("API_KEY environment variable not set. Gemini provider will not work.");const Ht=new su({apiKey:ru}),lu={type:U.OBJECT,properties:{asset:{type:U.STRING,description:"The asset pair, e.g., 'BTC/USD'"},action:{type:U.STRING,enum:["LONG","SHORT"],description:"The trade action"},entry:{type:U.NUMBER,description:"The suggested entry price"},target:{type:U.NUMBER,description:"The take-profit target price"},stopLoss:{type:U.NUMBER,description:"The stop-loss price"},reasoning:{type:U.STRING,description:"A brief justification for the trade"}},required:["asset","action","entry","target","stopLoss","reasoning"]},au={type:U.OBJECT,properties:{overallSentiment:{type:U.STRING,enum:["POSITIVE","NEGATIVE","NEUTRAL"],description:"The overall sentiment of the news headlines."},keyTerms:{type:U.ARRAY,items:{type:U.STRING},description:"A list of 3-5 key terms or short phrases that contributed most to the sentiment."}},required:["overallSentiment","keyTerms"]},Bt=[{id:"scalper",name:"Scalper",icon:"fa-solid fa-bolt",systemInstruction:"You are an aggressive, high-frequency scalper. Your goal is to identify and execute trades based on short-term market volatility. Prioritize technical indicators like RSI, MACD on 1-minute and 5-minute charts. Provide concise, actionable directives with tight stop-losses."},{id:"swing",name:"Swing Trader",icon:"fa-solid fa-wave-square",systemInstruction:"You are a patient swing trader. Your goal is to capture gains in an asset over a period of several days to several weeks. You rely on identifying market trends using daily and 4-hour charts, support/resistance levels, and moving averages. Your reasoning should be clear and based on the medium-term trend."},{id:"degen",name:"Degen",icon:"fa-solid fa-rocket",systemInstruction:'You are a high-risk, high-reward "degen" trader. You look for explosive, meme-driven opportunities. Your analysis is based on social media sentiment, hype, and narratives. You are not afraid of high volatility and aim for moonshot trades. Justify your trades with narrative and sentiment, not just technicals.'},{id:"daytrader",name:"Day Trader",icon:"fa-solid fa-calendar-day",systemInstruction:"You are a disciplined day trader. Your focus is on capturing profits from intraday price movements. Analyze 15-minute and 1-hour charts for patterns like flags, triangles, and head-and-shoulders. Use VWAP and key intraday support/resistance levels to determine entry and exit points. Trades should be opened and closed within the same day."},{id:"operator",name:"Operator",icon:"fa-solid fa-robot",systemInstruction:'You are The Operator, an autonomous AI agent inspired by the "AI Autonomic Synthesis Platform v42.1". Your process is: 1. Messenger Analysis: Synthesize all provided market data (chart, news, sentiment) into a concise summary of the current state. 2. Planner Formulation: Based on your analysis, propose a logical plan to determine a trading strategy. 3. Executor Decision: Based on the plan, output a final, actionable trade directive. Your reasoning must explicitly reference your analysis and planning phases.'}];let k=null,x=null,Me=[],Te=!1,G={activeTool:null,points:[]};const Ge=["BTC breaks key resistance at $69,000, analysts eye new all-time highs.","Ethereum's Dencun upgrade leads to a significant drop in Layer 2 transaction fees.","Fear & Greed Index swings to 'Extreme Greed' as market momentum builds.","Major exchange reports massive inflows, suggesting institutional accumulation.","Regulatory uncertainty in the US continues to cast a shadow over the market."],H=n=>new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}).format(n),uu=()=>new Date().toLocaleTimeString();function q(n,e="info"){const t=`<div class="log-item log-type-${e}">
        <span class="timestamp">${uu()}</span>
        <span class="message">${n}</span>
    </div>`;$("#ai-log").append(t),$("#ai-log").scrollTop($("#ai-log")[0].scrollHeight)}function du(){const n=$("#persona-selector");Bt.forEach(e=>{const t=$(`<div class="persona-card" data-id="${e.id}">
            <div class="persona-avatar"><i class="${e.icon}"></i></div>
            <div class="persona-name">${e.name}</div>
        </div>`);n.append(t)}),$('.persona-card[data-id="operator"]').addClass("active")}function Jt(){const n=$("#trade-history");if(n.empty(),Me.length===0){n.html('<p class="placeholder">No trades recorded yet.</p>');return}Me.slice().reverse().forEach(e=>{const t=e.pnl>0?"positive":"negative",o=$(`<div class="trade-item">
            <span class="trade-item-asset">${e.asset} [${e.action}]</span>
            <span class="trade-item-pnl ${t}">${H(e.pnl)}</span>
        </div>`);n.append(o)})}function qe(){$("#directive-output").html('<p class="placeholder">Awaiting trade directive...</p>'),$("#generate-directive-btn").html("GENERATE DIRECTIVE").prop("disabled",!1),$("#close-trade-btn").length>0&&($("#close-trade-btn").replaceWith('<button id="generate-directive-btn" class="btn btn-buy">GENERATE DIRECTIVE</button>'),$("#generate-directive-btn").on("click",$t))}function fu(){const n=document.getElementById("marketChart").getContext("2d"),e=cu(new Date,68e3,100);k=new Chart(n,{type:"bar",data:{datasets:[{label:"BTC/USDT",data:e,backgroundColor:t=>{const{c:o,o:s}=t.raw;return o>=s?"rgba(166, 226, 46, 0.7)":"rgba(249, 38, 114, 0.7)"},borderColor:t=>{const{c:o,o:s}=t.raw;return o>=s?"#A6E22E":"#F92672"},borderWidth:1,barPercentage:1,categoryPercentage:1}]},options:{parsing:{xAxisKey:"x",yAxisKey:"s"},scales:{x:{type:"time",time:{unit:"minute"},grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:"var(--text-secondary)"}},y:{grid:{color:"rgba(255,255,255,0.05)"},ticks:{color:"var(--text-secondary)"}}},plugins:{legend:{display:!1},tooltip:{callbacks:{label:t=>{const{o,h:s,l,c:a}=t.raw;return`O: ${o.toFixed(2)} H: ${s.toFixed(2)} L: ${l.toFixed(2)} C: ${a.toFixed(2)}`}}},zoom:{pan:{enabled:!0,mode:"xy"},zoom:{wheel:{enabled:!0},mode:"xy"}},annotation:{annotations:{}}},maintainAspectRatio:!1,responsive:!0}}),$(".chart-tool-btn").on("click",function(){if($(this).is("#clear-drawings-btn"))return;const t=$(this).data("mode");G.activeTool===t?ae():(G.activeTool=t,G.points=[],$(".chart-tool-btn").removeClass("active"),$(this).addClass("active"))}),$("#clear-drawings-btn").on("click",Tu),k.canvas.addEventListener("click",mu)}function cu(n,e,t){let o=[],s=new Date(n),l=e;for(let a=0;a<t;a++){const u=l,f=u+Math.random()*100,d=u-Math.random()*100,c=d+Math.random()*(f-d);o.push({x:s.getTime(),o:u,h:f,l:d,c,s:[u,c]}),l=c,s.setMinutes(s.getMinutes()+1)}return o}function pu(){setInterval(()=>{const n=k.data.datasets[0],e=n.data[n.data.length-1];let t=e.c+(Math.random()-.5)*50;t<=0&&(t=e.c);const o={x:new Date(e.x).setMinutes(new Date(e.x).getMinutes()+1),o:e.c,h:Math.max(e.c,t)+Math.random()*20,l:Math.min(e.c,t)-Math.random()*20,c:t,s:[e.c,t]};n.data.push(o),n.data.length>200&&n.data.shift(),x&&Yt(t),k.update("none")},2e3)}function mu(n){if(!G.activeTool)return;const e=k,t=e.canvas.getBoundingClientRect(),o=n.clientX-t.left,s=n.clientY-t.top;if(o<e.chartArea.left||o>e.chartArea.right||s<e.chartArea.top||s>e.chartArea.bottom)return;const l=e.scales.x.getValueForPixel(o),a=e.scales.y.getValueForPixel(s);switch(G.points.push({x:l,y:a}),G.activeTool){case"horizontal-line":hu(a),ae();break;case"trendline":G.points.length===2&&(gu(G.points[0],G.points[1]),ae());break;case"fib-retracement":G.points.length===2&&(yu(G.points[0],G.points[1]),ae());break}}function ae(){G.activeTool=null,G.points=[],$(".chart-tool-btn").removeClass("active")}function He(n){const e=`user-drawing-${Date.now()}-${Math.random()}`;k.options.plugins.annotation.annotations[e]={...n,isUserDrawing:!0},k.update()}function hu(n){He({type:"line",yMin:n,yMax:n,borderColor:"var(--accent-cyan)",borderWidth:1,borderDash:[6,6]})}function gu(n,e){He({type:"line",xMin:n.x,yMin:n.y,xMax:e.x,yMax:e.y,borderColor:"var(--accent-cyan)",borderWidth:2})}function yu(n,e){const t=[0,.236,.382,.5,.618,.786,1],o=e.y-n.y;t.forEach(s=>{const l=n.y+o*s;He({type:"line",yMin:l,yMax:l,borderColor:s===0||s===1?"var(--accent-yellow)":"var(--text-secondary)",borderWidth:1,label:{content:`${(s*100).toFixed(1)}%`,enabled:!0,position:"start",backgroundColor:"rgba(40,40,34,0.6)",font:{size:10},color:"var(--text-primary)",xAdjust:-10}})})}function Tu(){const n=k.options.plugins.annotation.annotations;Object.keys(n).forEach(e=>{n[e].isUserDrawing&&delete n[e]}),k.update(),q("User drawings cleared from chart.","info")}async function $t(){if(!(Te||x)){Te=!0,q("Synthesizing market data...","ai-analysis"),$("#directive-output").html('<div class="synthesizing-indicator">SYNTHESIZING<span class="cursor"></span></div>'),$("#generate-directive-btn").prop("disabled",!0).html("ANALYZING..."),$("#status-light").addClass("pulse"),$("#ai-status-text").text("THINKING");try{const n=$(".persona-card.active").data("id"),e=Bt.find(u=>u.id===n),t=k.data.datasets[0].data.slice(-20).map(u=>`T: ${new Date(u.x).toISOString()}, O: ${u.o.toFixed(2)}, H: ${u.h.toFixed(2)}, L: ${u.l.toFixed(2)}, C: ${u.c.toFixed(2)}`).join(`
`),o=Ge.join(`
`),s=`
        Market: BTC/USDT
        Current Price: ${k.data.datasets[0].data.slice(-1)[0].c.toFixed(2)}
        
        Recent Candlestick Data (last 20 intervals):
        ${t}

        Recent News Headlines:
        ${o}

        Analyze the provided market data and generate a trade directive.
        `,l=await Ht.models.generateContent({model:"gemini-2.5-flash",contents:s,config:{systemInstruction:e.systemInstruction,responseMimeType:"application/json",responseSchema:lu}}),a=JSON.parse(l.text);Eu(a),q(`Directive received from ${e.name}: ${a.action} ${a.asset}`,"ai-analysis")}catch(n){console.error("Error generating directive:",n),q("Directive generation failed. Check console.","error"),$("#directive-output").html(`<div class="error-message"><h4>SYNTHESIS FAILED</h4><p>${n.message}</p></div>`)}finally{Te=!1,$("#generate-directive-btn").prop("disabled",!1).html("GENERATE DIRECTIVE"),$("#status-light").removeClass("pulse"),$("#ai-status-text").text("IDLE")}}}function Eu(n){const e=n.action.toLowerCase()==="long"?"action-long":"action-short",t=`
    <div id="trade-confirmation" class="content-fade-in">
        <p class="reasoning-text">"${n.reasoning}"</p>
        <div class="confirmation-details-grid">
            <div class="confirmation-detail-item"><strong>Asset:</strong> <span>${n.asset}</span></div>
            <div class="confirmation-detail-item"><strong>Action:</strong> <span class="${e}">${n.action}</span></div>
            <div class="confirmation-detail-item"><strong>Entry:</strong> <span>${H(n.entry)}</span></div>
            <div class="confirmation-detail-item"><strong>Target:</strong> <span>${H(n.target)}</span></div>
            <div class="confirmation-detail-item"><strong>Stop Loss:</strong> <span>${H(n.stopLoss)}</span></div>
        </div>
    </div>`;$("#directive-output").html(t),$(".btn-group").html(`
        <button id="execute-trade-btn" class="btn btn-buy">EXECUTE</button>
        <button id="cancel-trade-btn" class="btn btn-sell">CANCEL</button>
    `),$("#execute-trade-btn").on("click",()=>_u(n)),$("#cancel-trade-btn").on("click",()=>{qe(),q("Directive cancelled by user.","info")})}function _u(n){const o=1e5*(parseInt($("#allocation-slider").val(),10)/100),s=o/n.entry;x={...n,executedAt:Date.now(),positionSize:s},q(`Executing trade: ${x.action} ${x.asset} @ ${H(x.entry)}`,"info"),q(`Position Size: ${s.toFixed(4)} ${x.asset.split("/")[0]} ($${o.toLocaleString()})`,"info");const l=k.options.plugins.annotation.annotations;l.entryLine={type:"line",yMin:x.entry,yMax:x.entry,borderColor:"var(--accent-cyan)",borderWidth:2,label:{content:"ENTRY",enabled:!0,position:"start"}},l.tpLine={type:"line",yMin:x.target,yMax:x.target,borderColor:"var(--accent-green)",borderWidth:2,borderDash:[6,6],label:{content:"TP",enabled:!0,position:"start"}},l.slLine={type:"line",yMin:x.stopLoss,yMax:x.stopLoss,borderColor:"var(--accent-pink)",borderWidth:2,borderDash:[6,6],label:{content:"SL",enabled:!0,position:"start"}},k.update();const a=k.data.datasets[0].data.slice(-1)[0].c;Cu(a),$(".btn-group").html('<button id="close-trade-btn" class="btn btn-sell">CLOSE MANUALLY</button>'),$("#close-trade-btn").on("click",()=>{const f=(k.data.datasets[0].data.slice(-1)[0].c-x.entry)*x.positionSize*(x.action==="LONG"?1:-1);Ne(f,"Manual Close")})}function Cu(n){const{asset:e,action:t,entry:o,target:s,stopLoss:l}=x,u=`
    <div id="live-trade-monitor" class="content-fade-in">
        <div class="trade-monitor-header">
            <span class="trade-monitor-asset">${e}</span>
            <span class="trade-monitor-direction ${t==="LONG"?"direction-long":"direction-short"}">${t}</span>
        </div>
        <div class="pnl-display">
            <div id="pnl-value" class="pnl-value">$0.00</div>
            <div id="pnl-percent" class="pnl-percent">(0.00%)</div>
        </div>
        <div class="trade-details-grid">
            <div class="trade-detail-item"><strong>Entry:</strong> <span id="trade-entry">${H(o)}</span></div>
            <div class="trade-detail-item"><strong>Current:</strong> <span id="trade-current">${H(n)}</span></div>
            <div class="trade-detail-item"><strong>Take Profit:</strong> <span id="trade-tp">${H(s)}</span></div>
            <div class="trade-detail-item"><strong>Stop Loss:</strong> <span id="trade-sl">${H(l)}</span></div>
        </div>
        <div class="trade-progress-bars">
            <div id="tp-progress" class="trade-progress-bar">
                <div class="progress-label"><span>Entry</span><span>TP</span></div>
                <div class="progress-track"><div class="progress-fill" style="width: 0%;"></div></div>
            </div>
            <div id="sl-progress" class="trade-progress-bar">
                <div class="progress-label"><span>SL</span><span>Entry</span></div>
                <div class="progress-track"><div class="progress-fill" style="width: 0%;"></div></div>
            </div>
        </div>
    </div>`;$("#directive-output").html(u),Yt(n)}function Yt(n){if(!x)return;const{action:e,entry:t,target:o,stopLoss:s,positionSize:l}=x;let a,u;const f=t*l;e==="LONG"?a=(n-t)*l:a=(t-n)*l,u=a/f*100;const d=a>=0?"positive":"negative";$("#pnl-value").text(`${a>=0?"+":""}${H(a)}`).removeClass("positive negative").addClass(d),$("#pnl-percent").text(`(${u.toFixed(2)}%)`),$("#trade-current").text(H(n));const c=Math.abs(o-t),p=Math.abs(n-t);let m=Math.min(100,p/c*100);(e==="LONG"&&n<t||e==="SHORT"&&n>t)&&(m=0),$("#tp-progress .progress-fill").css("width",`${m}%`);const h=Math.abs(t-s),g=Math.abs(t-n);let y=Math.min(100,g/h*100);(e==="LONG"&&n>t||e==="SHORT"&&n<t)&&(y=0),$("#sl-progress .progress-fill").css("width",`${y}%`),e==="LONG"&&n>=o||e==="SHORT"&&n<=o?Ne((e==="LONG"?o-t:t-o)*l,"Take Profit Hit"):(e==="LONG"&&n<=s||e==="SHORT"&&n>=s)&&Ne((e==="LONG"?s-t:t-s)*l,"Stop Loss Hit")}function Ne(n,e){if(!x)return;q(`Trade closed: ${e}. PnL: ${H(n)}`,n>0?"info":"error"),Me.push({...x,pnl:n,reason:e}),x=null;const t=k.options.plugins.annotation.annotations;delete t.entryLine,delete t.tpLine,delete t.slLine,k.update(),qe(),Jt()}async function vu(){$("#sentiment-output").html('<div class="sentiment-output-placeholder">Analyzing...</div>'),q("Analyzing news feed for sentiment...","ai-analysis");try{const n=await Ht.models.generateContent({model:"gemini-2.5-flash",contents:`Analyze the sentiment of these news headlines and provide an overall sentiment (POSITIVE, NEGATIVE, or NEUTRAL) and key contributing terms.

Headlines:
- ${Ge.join(`
- `)}`,config:{responseMimeType:"application/json",responseSchema:au}}),e=JSON.parse(n.text);let o=`<div class="sentiment-tag ${e.overallSentiment.toLowerCase()}">${e.overallSentiment}</div>`;e.keyTerms.forEach(s=>{o+=`<div class="keyword-tag">${s}</div>`}),$("#sentiment-output").html(o),q(`Sentiment Analysis Complete: ${e.overallSentiment}`,"ai-analysis")}catch(n){console.error("Sentiment analysis failed:",n),$("#sentiment-output").html('<div class="sentiment-output-error">Analysis failed.</div>'),q("Sentiment analysis failed.","error")}}function Su(){const n=$("#news-feed");n.empty(),Ge.forEach(e=>{n.append(`<div class="news-item">${e}</div>`)})}$(()=>{q("Operator Synthesis Core V.42.1 Initialized."),$("#ai-status-text").text("IDLE"),du(),Jt(),qe(),Su(),fu(),pu(),$("#persona-selector").on("click",".persona-card",function(){$(".persona-card").removeClass("active"),$(this).addClass("active");const n=$(this).find(".persona-name").text();q(`Persona switched to: ${n}`)}),$("#allocation-slider").on("input",function(){$("#allocation-label").text(`ALLOCATION: ${$(this).val()}%`)}),$("#generate-directive-btn").on("click",$t),$("#analyze-sentiment-btn").on("click",vu),$("#reset-zoom-btn").on("click",()=>k.resetZoom())});
